<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>它夏了夏天</title>
  
  <subtitle>生命中有一种遇见，就让它美如行云流水，然后一生去回味。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://tokyle.com/"/>
  <updated>2018-06-21T07:06:15.542Z</updated>
  <id>http://tokyle.com/</id>
  
  <author>
    <name>Kyle</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>test</title>
    <link href="http://tokyle.com/2018/06/21/test/"/>
    <id>http://tokyle.com/2018/06/21/test/</id>
    <published>2018-06-21T07:05:46.000Z</published>
    <updated>2018-06-21T07:06:15.542Z</updated>
    
    <content type="html"><![CDATA[<p>测试</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;测试&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>计算机基础知识系列（一）</title>
    <link href="http://tokyle.com/2018/06/19/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://tokyle.com/2018/06/19/计算机基础知识系列（一）/</id>
    <published>2018-06-19T07:37:10.000Z</published>
    <updated>2018-06-21T06:25:16.632Z</updated>
    
    <content type="html"><![CDATA[<p>程序员基础，性能测试需要知道的一些底层概念（一）</p><a id="more"></a><h3 id="进程、线程、程序"><a href="#进程、线程、程序" class="headerlink" title="进程、线程、程序"></a>进程、线程、程序</h3><p><code>对操作系统来说，线程是最小的执行单元，进程是最小的资源管理单元</code>，线程和进程都是由系统内核管理。</p><h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><p>程序被加载到内存中并准备执行，就是一个进程，它是操作系统动态执行的基本单元，在传统的操作系统中，进程既是基本的分配单元，也是基本的执行单元。<br>关于进程有两点需要注意：<br><strong>一、</strong>进程是一个实体。每一个进程都有它自己的地址空间，一般情况下，包括文本区域（text region）、数据区域（data region）和堆栈（stack region）。文本区域存储处理器执行的代码；数据区域存储变量和进程执行期间使用的动态分配的内存；堆栈区域存储着活动过程调用的指令和本地变量；<br><strong>二、</strong>进程是一个“执行中的程序”。程序是一个没有生命的实体，只有处理器赋予程序生命时，它才能成为一个活动的实体，我们称其为进程。</p><h5 id="进程状态"><a href="#进程状态" class="headerlink" title="进程状态"></a>进程状态</h5><p>进程有三个状态，<code>就绪-运行-阻塞</code>。就绪状态其实就是获取除CPU之外的所有资源，只要处理器分配资源就可以马上执行；运行状态就是获取了处理器分配的资源，开始运行程序；阻塞状态，当程序条件不够时，需要等待条件满足才能继续执行，例如I/O。</p><h4 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h4><p>程序其实本身没有任何运行的含义，程序是指令和数据的有序集合。</p><h4 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h4><h5 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h5><p>单个进程中执行中的每个任务就是一个线程，线程是进程中执行运算的最小单位。一个线程只能属于一个进程，但是一个进程可以拥有多个线程。多线程处理就是允许一个进程中在同一时刻执行多个任务。</p><h4 id="进程与线程的区别"><a href="#进程与线程的区别" class="headerlink" title="进程与线程的区别"></a>进程与线程的区别</h4><p>1，线程没有地址空间，线程包含在进程的地址空间中。线程上下文只包含一个堆栈、一个寄存器、一个优先权，线程文本包含在他的进程的文本片段中。同一进程中的多个线程共享代码段(代码和常量)，数据段(全局变量和静态变量)，扩展段(堆存储)。但是每个线程拥有自己的栈段，寄存器的内容（栈段又叫运行时段，用来存放所有局部变量和临时变量）。<br>2，线程在执行过程中与进程还是有区别的。每个独立的进程有一个程序运行的入口、顺序执行序列和程序的出口。但是线程不能够独立执行，必须依存在应用程序中，由应用程序提供多个线程执行控制。<br>3，从逻辑角度来看，多线程的意义在于一个应用程序中，有多个执行部分可以同时执行。但操作系统并没有将多个线程看做多个独立的应用，来实现进程的调度和管理以及资源分配。<br>4，线程和进程在使用上各有优缺点：线程执行开销小，但不利于资源的管理和保护；而进程正相反。<br>（进程就像火车，线程就是火车的车厢）</p><h3 id="多进程与多线程"><a href="#多进程与多线程" class="headerlink" title="多进程与多线程"></a>多进程与多线程</h3><h4 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h4><p>多线程，顾名思义，同时运行多个线程；多任务可以由多进程完成，也可以由一个进程内的多线程完成。</p><h5 id="线程状态"><a href="#线程状态" class="headerlink" title="线程状态"></a>线程状态</h5><p>首先，线程大致有五种状态:初始化，就绪，运行，阻塞，死亡；</p><h5 id="线程锁"><a href="#线程锁" class="headerlink" title="线程锁"></a>线程锁</h5><p>在多线程中，每个线程都有自己的资源，但是代码区是共享的，即每个线程都可以执行相同的函数。这可能带来的问题就是几个线程同时执行一个函数，导致数据的混乱，产生不可预料的结果，因此我们必须避免这种情况的发生。例如：有两个线程，同时操作一个列表， 列表中数值都是0，一个线程是更新（update），操作为从前往后顺序更新值为1；线程二为打印（print），操作为从后往前倒序打印列表，当两个线程同时操作列表时就会出现打印时一半0，一半1，出现了数据不同步，为了避免这样的情况，就引进了线程锁的概念。</p><p>锁有两种状态——锁定和未锁定。每当一个线程比如”update”要访问共享数据时，必须先获得锁定；如果已经有别的线程比如”print”获得锁定了，那么就让线程”update”暂停，也就是同步阻塞；等到线程”print”访问完毕，释放锁以后，再让线程”update”继续。经过这样的处理，打印列表时要么全部输出0，要么全部输出1，不会再出现一半0一半1的混乱数据。</p><h5 id="线程通信（条件变量）"><a href="#线程通信（条件变量）" class="headerlink" title="线程通信（条件变量）"></a>线程通信（条件变量）</h5><p>列表并不是一开始就有的；而是通过线程”create”创建的。如果”update”或者”print” 在”create”还没有运行的时候就访问列表，将会出现一个异常。使用锁可以解决这个问题，但是”update”和”print”将需要一个无限循环——他们不知道”create”什么时候会运行，让”create”在运行后通知”update”和”print”显然是一个更好的解决方案。于是，引入了条件变量。</p><p>条件变量允许线程比如”update”和”print”在条件不满足的时候（列表为None时）等待，等到条件满足的时候（列表已经创建）发出一个通知，告诉”update” 和”print”条件已经有了，你们该起床干活了；然后”update”和”print”才继续运行。</p><h5 id="线程运行和阻塞状态转换"><a href="#线程运行和阻塞状态转换" class="headerlink" title="线程运行和阻塞状态转换"></a>线程运行和阻塞状态转换</h5><p>阻塞有三种状态：<br>同步阻塞（锁定池）是指处于竞争锁定的状态，线程请求锁定时将进入这个状态，一旦成功获得锁定又恢复到运行状态；<br>等待阻塞（等待池）是指等待其他线程通知的状态，线程获得条件锁定后，调用“等待”将进入这个状态，一旦其他线程发出通知，线程将进入同步阻塞状态，再次竞争条件锁定；<br>而其他阻塞是指调用time.sleep()、anotherthread.join()或等待IO时的阻塞，这个状态下线程不会释放已获得的锁定。</p><h4 id="多进程"><a href="#多进程" class="headerlink" title="多进程"></a>多进程</h4><p>为啥会想看多进程这么个东西，那是因为，python说实话，有点坑的地方是，实质上python没有多线程。python虽然可以通过<code>threading</code>模块来实现多线程编程，但是Python的线程虽然是真正的线程，但解释器执行代码时，有一个GIL锁：Global Interpreter Lock，任何Python线程执行前，必须先获得GIL锁，然后，每执行100条字节码，解释器就自动释放GIL锁，让别的线程有机会执行。这个GIL全局锁实际上把所有线程的执行代码都给上了锁，所以，多线程在Python中只能交替执行，即使100个线程跑在100核CPU上，也只能用到1个核。而通常我们用的解释器是官方实现的CPython，要真正利用多核，除非重写一个不带GIL的解释器。所以使用python实现并发多线程，不太现实。。</p><p>不过即使如此，我们也可以使用多进程来实现多核任务，毕竟当前多核处理器满大街都是。</p><h5 id="实现多进程"><a href="#实现多进程" class="headerlink" title="实现多进程"></a>实现多进程</h5><p>首先，unix中有个fork()函数，这玩意就可以实现多进程，这函数产生的效果就是把当前进程复制一份，普通的函数调用，调用一次，返回一次，但是fork()调用一次，返回两次，因为操作系统自动把当前进程（称为父进程）复制了一份（称为子进程），然后，分别在父进程和子进程内返回。子进程永远返回0，而父进程返回子进程的ID。这样做的理由是，一个父进程可以fork出很多子进程，所以，父进程要记下每个子进程的ID，而子进程只需要调用getppid()就可以拿到父进程的ID。</p><p>python的os模块封装了fork()，可以很简单就实现创建子进程；但是由于windows系统没有fork()，在windows上就不能执行包含fork()调用的脚本，在windows上就用<code>multiprocessing</code>替代。</p><h5 id="multiprocessing-示例"><a href="#multiprocessing-示例" class="headerlink" title="multiprocessing 示例"></a>multiprocessing 示例</h5><p>使用<code>multiprocessing</code>模块进行多进程编程，可以支持跨平台。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@Auther Kyle</span><br><span class="line">@Time 2018/6/19 13:10</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from multiprocessing import Pool</span><br><span class="line">import os, time, random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def LongTimeTask(name):</span><br><span class="line">    print(&quot;Run task&#123;0&#125; &#123;1&#125;&quot;.format(name, os.getpid()))</span><br><span class="line">    start = time.time()</span><br><span class="line">    time.sleep(random.random() * 3)</span><br><span class="line">    end = time.time()</span><br><span class="line">    print(&quot;Task &#123;0&#125; runs &#123;1&#125; seconds.&quot;.format(name, (end - start)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    print(&quot;Parent process &#123;0&#125;&quot;.format(os.getpid()))</span><br><span class="line">    p = Pool(4)</span><br><span class="line">    for i in range(5):</span><br><span class="line">        p.apply_async(LongTimeTask, args=(i, ))</span><br><span class="line">    print(&quot;Waiting for all subprocesses done...&quot;)</span><br><span class="line">    p.close()</span><br><span class="line">    p.join()</span><br><span class="line">    print(&quot;All subprocess done&quot;)</span><br></pre></td></tr></table></figure></p><p>执行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Parent process 1692</span><br><span class="line">Waiting for all subprocesses done...</span><br><span class="line">Run task0 4464</span><br><span class="line">Run task1 5516</span><br><span class="line">Run task2 2388</span><br><span class="line">Run task3 8540</span><br><span class="line">Task 3 runs 0.22301292419433594 seconds.</span><br><span class="line">Run task4 8540</span><br><span class="line">Task 1 runs 0.463026762008667 seconds.</span><br><span class="line">Task 2 runs 1.3660781383514404 seconds.</span><br><span class="line">Task 4 runs 1.2180695533752441 seconds.</span><br><span class="line">Task 0 runs 1.7631008625030518 seconds.</span><br><span class="line">All subprocess done</span><br></pre></td></tr></table></figure></p><h5 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h5><p>multiprocessing提供多种方法来交换数据：<code>Queue</code>，<code>Pipes</code>等。<br>代码示例:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@Auther Kyle</span><br><span class="line">@Time 2018/6/19 14:56</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from multiprocessing import Process, Queue</span><br><span class="line">import os, time, random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def write(q):</span><br><span class="line">    &quot;&quot;&quot;写数据进程执行&quot;&quot;&quot;</span><br><span class="line">    print(&quot;Process to write: &#123;0&#125;&quot;.format(os.getpid()))</span><br><span class="line">    for value in [&apos;A&apos;, &apos;B&apos;, &apos;C&apos;]:</span><br><span class="line">        print(&quot;Put &#123;0&#125; to queue.&quot;.format(value))</span><br><span class="line">        q.put(value)</span><br><span class="line">        time.sleep(random.random())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def read(q):</span><br><span class="line">    &quot;&quot;&quot;读数据进程执行&quot;&quot;&quot;</span><br><span class="line">    print(&quot;Process to read: &#123;0&#125;&quot;.format(os.getpid()))</span><br><span class="line">    while True:</span><br><span class="line">        value = q.get(True)</span><br><span class="line">        print(&quot;Get &#123;0&#125; from queue.&quot;.format(value))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    # 父进程创建Queue，传给各个子进程</span><br><span class="line">    q = Queue()</span><br><span class="line">    pw = Process(target=write, args=(q,))</span><br><span class="line">    pr = Process(target=read, args=(q,))</span><br><span class="line">    # 启动子进程pw，写入</span><br><span class="line">    pw.start()</span><br><span class="line">    # 启动子进程pr，读取</span><br><span class="line">    pr.start()</span><br><span class="line">    # 等待写进程执行结束</span><br><span class="line">    pw.join()</span><br><span class="line">    # pr进程里是死循环，无法等待其结束，只能强行终止</span><br><span class="line">    pr.terminate()</span><br></pre></td></tr></table></figure></p><p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Process to read: 7616</span><br><span class="line">Process to write: 4948</span><br><span class="line">Put A to queue.</span><br><span class="line">Get A from queue.</span><br><span class="line">Put B to queue.</span><br><span class="line">Get B from queue.</span><br><span class="line">Put C to queue.</span><br><span class="line">Get C from queue.</span><br></pre></td></tr></table></figure></p><p>以上代码均来自于网络~</p><h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><p>协程，又称微线程，英文Coroutines，是一种比线程更加轻量级的存在。正如一个进程可以拥有多个线程一样，一个线程也可以拥有多个协程。（关于协程，真的不太懂，之后有空再研究，看到一句话:子程序就是协程的一种特例）多线程编程中，为了防止数据不同步，需要添加锁机制，但是协程应为就用了一个线程，在协程之间共享资源是不用加锁机制的，只需要判断状态。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><blockquote><p><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431927781401bb47ccf187b24c3b955157bb12c5882d000" target="_blank" rel="noopener">廖雪峰关于多进程教程</a><br><a href="http://www.cnblogs.com/huxi/archive/2010/06/26/1765808.html" target="_blank" rel="noopener">Python线程指南</a><br><a href="https://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000/0013868328689835ecd883d910145dfa8227b539725e5ed000" target="_blank" rel="noopener">廖雪峰-协程教程</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;程序员基础，性能测试需要知道的一些底层概念（一）&lt;/p&gt;
    
    </summary>
    
      <category term="计算机基础" scheme="http://tokyle.com/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="python3" scheme="http://tokyle.com/tags/python3/"/>
    
      <category term="进程" scheme="http://tokyle.com/tags/%E8%BF%9B%E7%A8%8B/"/>
    
      <category term="线程" scheme="http://tokyle.com/tags/%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>Centos下切换MySQL数据到数据盘</title>
    <link href="http://tokyle.com/2018/06/12/Centos%E4%B8%8B%E5%88%87%E6%8D%A2MySQL%E6%95%B0%E6%8D%AE%E5%88%B0%E6%95%B0%E6%8D%AE%E7%9B%98/"/>
    <id>http://tokyle.com/2018/06/12/Centos下切换MySQL数据到数据盘/</id>
    <published>2018-06-12T06:47:31.000Z</published>
    <updated>2018-06-21T06:25:06.425Z</updated>
    
    <content type="html"><![CDATA[<p>centos 7对ECS进行挂载数据盘，并切换MySQL数据保存目录到数据盘<br><a id="more"></a></p><p>测试需要，申请了阿里云的ECS服务器，用来搭建MySQL，搭建时候没有注意，没想到运维大哥那么体贴的申请了数据盘，还是SSD的，这样也就需要把原来MySQL数据存储路径换到数据盘。</p><h3 id="操作数据盘"><a href="#操作数据盘" class="headerlink" title="操作数据盘"></a>操作数据盘</h3><p>首先查看当前服务器是否有数据盘：<code>fdisk -l</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Disk /dev/vda: 53.7 GB, 53687091200 bytes, 104857600 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0008d73a</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vda1   *        2048   104855551    52426752   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 107.4 GB, 107374182400 bytes, 209715200 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br></pre></td></tr></table></figure></p><p>可以看到当前服务上面有两个盘<code>/dev/vda</code>和<code>/dev/vdb</code>，其中<code>/dev/vda</code>是系统盘，并且已经有分区<code>/dev/vda1</code>，经常使用的查看磁盘的命令是<code>df -h</code>，但是有个问题，如果你的数据盘没有分区、挂载，使用<code>df -h</code>是不会显示的，只会展示这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Filesystem      Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/vda1        50G  3.1G   44G   7% /</span><br><span class="line">devtmpfs         16G     0   16G   0% /dev</span><br><span class="line">tmpfs            16G     0   16G   0% /dev/shm</span><br><span class="line">tmpfs            16G  520K   16G   1% /run</span><br><span class="line">tmpfs            16G     0   16G   0% /sys/fs/cgroup</span><br><span class="line">tmpfs           3.2G     0  3.2G   0% /run/user/0</span><br></pre></td></tr></table></figure></p><h4 id="数据盘分区"><a href="#数据盘分区" class="headerlink" title="数据盘分区"></a>数据盘分区</h4><p>查找到数据盘<code>/dev/vdb</code>之后，对它进行分区：<code>fdisk  /dev/vdb</code>，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain in memory only, until you decide to write them.</span><br><span class="line">Be careful before using the write command.</span><br><span class="line"></span><br><span class="line">Device does not contain a recognized partition table</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x39e32289.</span><br></pre></td></tr></table></figure></p><p>接下来是有几个选项，选择适合的选项即可：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Command (m for help):   输入&apos;n&apos;，创建一个新分区</span><br><span class="line">Partition type:输入&apos;p&apos;，选择主分区</span><br><span class="line">Partition number (1-4, default 1):输入&apos;1&apos;，仅创建一个分区</span><br><span class="line">First sector (2048-209715199, default 2048): 我用的默认</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (2048-209715199, default 209715199):  同样默认</span><br></pre></td></tr></table></figure></p><p>接下来<code>wq</code>保存退出即可。<br>然后这个时候<code>fdisk -l</code>，就能看见新的分区：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Disk /dev/vda: 53.7 GB, 53687091200 bytes, 104857600 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x0008d73a</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vda1   *        2048   104855551    52426752   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/vdb: 107.4 GB, 107374182400 bytes, 209715200 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label type: dos</span><br><span class="line">Disk identifier: 0x39e32289</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/vdb1            2048   209715199   104856576   83  Linux</span><br></pre></td></tr></table></figure></p><h3 id="格式化分区"><a href="#格式化分区" class="headerlink" title="格式化分区"></a>格式化分区</h3><p>首先新建文件夹：<code>cd /home</code>、<code>mkdir mysql</code><br>挂载：<code>mount /dev/vdb1 /home/mysql</code><br>在新分区上创建文件系统：<code>mkfs.ext4 /dev/vdb1</code><br>备份<code>/etc/fstab</code>：<code>cp /etc/fstab /etc/fstab.bak</code><br>查找当前磁盘分区的UUID：<code>blkid</code><br>向 /etc/fstab 写入新分区信息:<code>vim /etc/fstab</code>，写入<code>UUID=ec7443b1-14e4-4174-ae8a-2194484a754b /home/mysql           ext4    defaults 0 0</code>(UUID是之前获得的)</p><h3 id="复制MySQL数据"><a href="#复制MySQL数据" class="headerlink" title="复制MySQL数据"></a>复制MySQL数据</h3><p>复制数据：<code>mv /var/lib/mysql/* /home/mysql</code><br>修改配置：<code>vim /etc/my.cnf</code>，修改数据文件到<code>/home/mysql</code><br>重启MySQL<br>OVER~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;centos 7对ECS进行挂载数据盘，并切换MySQL数据保存目录到数据盘&lt;br&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="mysql" scheme="http://tokyle.com/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>使用fiddler抓iphone包</title>
    <link href="http://tokyle.com/2018/06/07/%E4%BD%BF%E7%94%A8fiddler%E6%8A%93iphone%E5%8C%85/"/>
    <id>http://tokyle.com/2018/06/07/使用fiddler抓iphone包/</id>
    <published>2018-06-07T03:10:26.000Z</published>
    <updated>2018-06-21T06:25:12.568Z</updated>
    
    <content type="html"><![CDATA[<p>使用fiddler抓包iphone</p><a id="more"></a><p>亲测可用，系统及版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Fiddler: Telerik Fiddler Web Debugger (v2.6.3.48898)</span><br><span class="line">iphone 6s(ios 11.3.1)</span><br></pre></td></tr></table></figure></p><h3 id="Fiddler设置"><a href="#Fiddler设置" class="headerlink" title="Fiddler设置"></a>Fiddler设置</h3><p>首先，需要设置下fiddler，至于fiddler的下载安装就不说了。</p><h4 id="配置监听https"><a href="#配置监听https" class="headerlink" title="配置监听https"></a>配置监听https</h4><p>需要配置fiddler，使得允许监听<code>https</code>，因为fiddler默认是抓http格式的。<br>(再次声明，受不了七牛云之类的手持身份证实名认证的措施，由于之前工作做过征信相关，对这方面有点在乎，能少泄露一点就少一点。。。所以，基本blog中一直是无图片~)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tools ——&gt; （Telerik）Fiddler Options ——&gt; https</span><br></pre></td></tr></table></figure></p><p>勾选<code>Decrypt Https traffic</code>，此时系统会提示你是否要安装fiddler的证书之类的，安装一下即可~</p><h4 id="远程连接配置"><a href="#远程连接配置" class="headerlink" title="远程连接配置"></a>远程连接配置</h4><p>配置完https之后，需要设置允许远程连接，还是在<code>Tools ——&gt; （Telerik）Fiddler Options</code><br>选择<code>Connections</code>，监听端口使用默认的<code>8888</code>即可，勾选<code>Allow remote computers to connect</code>，此时会弹出一个warning，提示你会开启远程连接，并且需要重启fiddler才会生效，点击确定即可；</p><p><strong>重启fiddler</strong></p><h3 id="iphone设置"><a href="#iphone设置" class="headerlink" title="iphone设置"></a>iphone设置</h3><h4 id="获取PC端ip"><a href="#获取PC端ip" class="headerlink" title="获取PC端ip"></a>获取PC端ip</h4><p>这个就比较简单了，<code>cmd ——&gt; ipconfig</code>拿到ip即可，例如<code>192.168.100.10</code></p><h4 id="iphone安装证书"><a href="#iphone安装证书" class="headerlink" title="iphone安装证书"></a>iphone安装证书</h4><p>首先确保手机和PC处于同一网络（直接连接同一wifi最简单），然后在手机浏览器中输入上述步骤获取的ip和端口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.100.10:8888</span><br></pre></td></tr></table></figure></p><p>页面会出现<code>Fiddler Echo Service</code>该页面，看到一条<code>You can download the FiddlerRoot certificate</code>，点击下载证书，然后信任安装证书即可（安装完的证书可以在iphone-设置-通用-描述文件中看到）（证书名字，我当时装的时候叫<strong>DO_NOT_TRUST_FiddlerRoot</strong>）</p><h4 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h4><p>安装完成证书，进入手机<code>设置-无限局域网</code>，选择连接的wifi，配置代理选择手动，输入服务器，端口，点击存储。<br>完成~</p><h3 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h3><p>手机浏览器访问页面，可以使用fiddler抓到包，看到请求和返回~以下抓到的示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: nginx</span><br><span class="line">Date: Thu, 07 Jun 2018 03:07:22 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Powered-By: PHP/7.1.5</span><br><span class="line">Set-Cookie: upv2=20180607%2C4; expires=Sat, 09-Jun-2018 03:07:22 GMT; Max-Age=172800; path=/</span><br><span class="line">Content-Length: 7346</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;zh-CN&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;古墓丽影：源起之战迅雷下载,百度网盘,高清迅雷下载 - 97电影网&lt;/title&gt;</span><br><span class="line">&lt;meta name=&quot;keywords&quot; content=&quot;古墓丽影：源起之战迅雷下载,古墓丽影：源起之战百度网盘资源,古墓丽影：源起之战高清迅雷下载 - 97电影网&quot; /&gt;</span><br><span class="line">&lt;meta name=&quot;description&quot; content=&quot;这里有电影《古墓丽影：源起之战》的百度网盘资源，还有《古墓丽影：源起之战》的迅雷下载链接,演员：艾丽西亚·维坎德,多米尼克·威斯特,沃尔顿·戈金斯,吴彦祖,克里斯汀·斯科特·托马斯,汉娜·乔恩-卡门,尼克·弗罗斯特,德里克·雅各比,安东尼奥·阿克儿,亚历山大·维尧姆,杰美·温斯顿,迈克尔·奥拜奥拉,艾米丽·凯里,肯尼思·霍&quot; /&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;icon&quot; href=&quot;http://www.id97.com/favicon.ico&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/amazeui.min.css&quot;&gt;</span><br><span class="line">    &lt;script src=&quot;http://libs.baidu.com/jquery/1.7.2/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/static/js/amazeui.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; rev=&quot;stylesheet&quot; type=&quot;text/css&quot; media=&quot;all&quot; href=&quot;http://www.id97.com/static/mobile/mobile.css&quot;&gt;</span><br><span class="line">    &lt;!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries --&gt;</span><br><span class="line">    &lt;!-- WARNING: Respond.js doesn&apos;t work if you view the page via file:// --&gt;</span><br><span class="line">    &lt;!--[if lt IE 9]&gt;</span><br><span class="line">      &lt;script src=&quot;http://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">      &lt;script src=&quot;http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;![endif]--&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;am-topbar-inverse&quot;&gt;</span><br><span class="line">    &lt;header class=&quot;am-container&quot;&gt;</span><br><span class="line">        &lt;h1 class=&quot;am-topbar-brand&quot;&gt;</span><br><span class="line">            &lt;a href=&quot;http://www.id97.com/&quot;&gt;97电影网&lt;/a&gt;</span><br><span class="line">        &lt;/h1&gt;</span><br><span class="line">        &lt;button class=&quot;am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only&quot; data-am-collapse=&quot;&#123;target: &apos;#doc-topbar-collapse&apos;&#125;&quot;&gt;&lt;span class=&quot;am-sr-only&quot;&gt;97电影网&lt;/span&gt; &lt;span class=&quot;am-icon-bars&quot;&gt;&lt;/span&gt;&lt;/button&gt;</span><br><span class="line">        &lt;div class=&quot;am-collapse am-topbar-collapse&quot; id=&quot;doc-topbar-collapse&quot;&gt;</span><br><span class="line">        &lt;ul class=&quot;am-nav am-nav-pills am-topbar-nav&quot;&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=&quot;http://www.id97.com/&quot;&gt;首页&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">            &lt;li&gt;&lt;a href=&quot;http://www.id97.com/movie&quot;&gt;电影&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;div class=&quot;am-topbar-right&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;form action=&quot;/search&quot; method=&quot;GET&quot; class=&quot;am-topbar-form am-topbar-left am-form-inline&quot; role=&quot;search&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;am-form-group&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; class=&quot;am-form-field am-input-sm&quot; name=&quot;q&quot; placeholder=&quot;搜索&quot;&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;div class=&quot;am-dropdown&quot; data-am-dropdown=&quot;&#123;boundary: &apos;.am-topbar&apos;&#125;&quot;&gt;</span><br><span class="line">                &lt;button class=&quot;am-btn am-btn-secondary am-topbar-btn am-btn-sm am-dropdown-toggle&quot; data-am-dropdown-toggle&gt;登入/注册 &lt;span class=&quot;am-icon-caret-down&quot;&gt;&lt;/span&gt;&lt;/button&gt;</span><br><span class="line">                &lt;ul class=&quot;am-dropdown-content&quot;&gt;</span><br><span class="line">                &lt;li&gt;&lt;a href=&quot;/signup&quot;&gt;注册&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                &lt;li&gt;&lt;a href=&quot;/signin&quot;&gt;登入&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        </span><br><span class="line">        &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/header&gt;</span><br><span class="line">&lt;/div&gt;&lt;div class=&quot;am-container&quot;&gt;</span><br><span class="line">    &lt;h3 class=&quot;am-article-title&quot;&gt;</span><br><span class="line">        古墓丽影：源起之战    &lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class=&quot;am-g&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;am-u-sm-5&quot;&gt;&lt;img class=&quot;img-responsive&quot; width=&quot;100%&quot; src=&quot;http://img1.xmspc.com/uploads/movie-poster/8ltxwirll3g7.jpg&quot;&gt;&lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;am-u-sm-7&quot; style=&quot;padding-left:0;font-size:14px;color:#666;&quot;&gt;</span><br><span class="line">&lt;strong&gt;主演：&lt;/strong&gt;艾丽西亚·维坎德 / 多米尼克·威斯特 / 沃尔顿·戈金斯 ...&lt;br/&gt;</span><br><span class="line">&lt;strong&gt;类型：&lt;/strong&gt;动作 / 冒险&lt;br/&gt;</span><br><span class="line">&lt;strong&gt;上映：&lt;/strong&gt;2018-03-16(美国/中国大陆)&lt;br/&gt;</span><br><span class="line">&lt;strong&gt;豆瓣：&lt;/strong&gt;6.3分&lt;br/&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;am-u-sm-12&quot; style=&quot;padding-top:15px;font-size:14px;color:#666;&quot;&gt;&lt;strong&gt;简介：&lt;/strong&gt;劳拉（艾丽西亚·维坎德 Alicia Vikander 饰）的父亲一生都致力于研究古墓，在劳拉尚且年幼的时候，父亲在一场冒险之中失踪了。一晃眼多年过去，劳拉一直拒绝承认父亲已死的消息，也拒绝接手父亲手下的商业帝国。&lt;br /&gt;</span><br><span class="line">一次偶然中，劳拉发现了父亲遗留下的冒险笔记，父亲希望劳拉能把这些资料付之一炬，但为了寻找父亲的下落，劳拉决定寻找笔记中记载的岛屿。劳拉找到了名为陆仁（吴彦祖 饰）的男子，两人结伴踏上了旅途。刚一上岛，劳拉和陆仁就遇见了一直和父亲作对的马赛亚斯（沃特·戈金斯 Walton Goggins 饰）以及他的雇佣兵团队。马赛亚斯一心想要找到古墓的踪迹，不惜杀死了不肯透露半点消息的劳拉的父亲，如今，劳拉亦落入了他的魔爪之中，会遭遇怎样的命运呢？&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;h3 class=&quot;res-h3&quot;&gt;资源列表：&lt;/h3&gt;</span><br><span class="line">    &lt;ul class=&quot;am-list res-list&quot;&gt;</span><br><span class="line">&lt;li class=&quot;list-group-item&quot;&gt;&lt;/li&gt;&lt;li&gt;&lt;p class=&quot;text-break&quot; style=&quot;margin:0;&quot;&gt;&lt;a href=&quot;https://pan.baidu.com/s/14V_KvaJcMIzwY3Octe4WDQ&quot;&gt;古墓丽影：源起之战 - 百度云，网盘资源，密码：3xvh&lt;/a&gt;&lt;/p&gt;&lt;textarea style=&quot;width:100%;&quot;&gt;https://pan.baidu.com/s/14V_KvaJcMIzwY3Octe4WDQ&lt;/textarea&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;p class=&quot;text-break&quot; style=&quot;margin:0;&quot;&gt;&lt;a href=&quot;ed2k://|file|%E5%8F%A4%E5%A2%93%E4%B8%BD%E5%BD%B1.%E6%BA%90%E8%B5%B7%E4%B9%8B%E6%88%98.Tomb.Raider.2018.HD1080P.%E4%B8%AD%E8%8B%B1%E5%8F%8C%E5%AD%97.mp4|2207922795|225513B29378FAEC5871822A46DE2F8D|h=NEFWJ3E5TL6ALZV2O63HVU5GALU6IGBI|/&quot;&gt;古墓丽影.源起之战.Tomb.Raider.2018.HD1080P.中英双字.mp4&lt;/a&gt;&lt;/p&gt;&lt;textarea style=&quot;width:100%;&quot;&gt;ed2k://|file|%E5%8F%A4%E5%A2%93%E4%B8%BD%E5%BD%B1.%E6%BA%90%E8%B5%B7%E4%B9%8B%E6%88%98.Tomb.Raider.2018.HD1080P.%E4%B8%AD%E8%8B%B1%E5%8F%8C%E5%AD%97.mp4|2207922795|225513B29378FAEC5871822A46DE2F8D|h=NEFWJ3E5TL6ALZV2O63HVU5GALU6IGBI|/&lt;/textarea&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;p class=&quot;text-break&quot; style=&quot;margin:0;&quot;&gt;&lt;a href=&quot;ed2k://|file|%E5%8F%A4%E5%A2%93%E4%B8%BD%E5%BD%B1.%E6%BA%90%E8%B5%B7%E4%B9%8B%E6%88%98.Tomb.Raider.2018.HD720P.%E4%B8%AD%E8%8B%B1%E5%8F%8C%E5%AD%97.mkv|1574630029|9D61330E39013720310FD4FBE83807FB|h=35M7EUX7TERZMN4QCYGSWIGC7F5JS4ZV|/&quot;&gt;古墓丽影.源起之战.Tomb.Raider.2018.HD720P.中英双字.mkv&lt;/a&gt;&lt;/p&gt;&lt;textarea style=&quot;width:100%;&quot;&gt;ed2k://|file|%E5%8F%A4%E5%A2%93%E4%B8%BD%E5%BD%B1.%E6%BA%90%E8%B5%B7%E4%B9%8B%E6%88%98.Tomb.Raider.2018.HD720P.%E4%B8%AD%E8%8B%B1%E5%8F%8C%E5%AD%97.mkv|1574630029|9D61330E39013720310FD4FBE83807FB|h=35M7EUX7TERZMN4QCYGSWIGC7F5JS4ZV|/&lt;/textarea&gt;&lt;/a&gt;&lt;/li&gt;    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;footer class=&quot;footer&quot;&gt;</span><br><span class="line">    &lt;p&gt;免责声明：本网站将逐步删除和规避程序自动搜索采集到的不提供分享的版权影视。本站仅供测试和学习交流。请大家支持正版。&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;唯一网址：&lt;a href=&quot;http://www.id97.com/&quot;&gt;97电影网&lt;/a&gt;&lt;/p&gt;</span><br><span class="line">&lt;/footer&gt;&lt;script src=&quot;https://www.szshouzhai.com/kdksd/c-5270-22.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var _hmt = _hmt || [];</span><br><span class="line">(function() &#123;</span><br><span class="line">  var hm = document.createElement(&quot;script&quot;);</span><br><span class="line">  hm.src = &quot;https://hm.baidu.com/hm.js?a6cc69b245346a568ba6088ab53ff7ac&quot;;</span><br><span class="line">  var s = document.getElementsByTagName(&quot;script&quot;)[0];</span><br><span class="line">  s.parentNode.insertBefore(hm, s);</span><br><span class="line">&#125;)();</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>OVER!</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用fiddler抓包iphone&lt;/p&gt;
    
    </summary>
    
      <category term="just for fun" scheme="http://tokyle.com/categories/just-for-fun/"/>
    
    
      <category term="fiddler" scheme="http://tokyle.com/tags/fiddler/"/>
    
      <category term="iphone" scheme="http://tokyle.com/tags/iphone/"/>
    
  </entry>
  
  <entry>
    <title>python3.6安装basemap</title>
    <link href="http://tokyle.com/2018/06/01/python3-6%E5%AE%89%E8%A3%85basemap/"/>
    <id>http://tokyle.com/2018/06/01/python3-6安装basemap/</id>
    <published>2018-06-01T09:55:58.000Z</published>
    <updated>2018-06-01T09:58:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>python3.6安装basemap</p><p>很久没碰matplotlib了，想看看有没有中国地图加人口，这样绘制一张图，找白天，貌似<code>basemap</code>里面有，basemap需要：<code>from mpl_toolkits.basemap import Basemap</code>，然后就尝试安装<code>mpl_toolkits</code>，不出所料，失败了。。。</p><p>折腾半天，附上windows下python3.6安装basemap步骤：</p><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>首先，一个神奇的网站，经常逛：</p><blockquote><p><a href="https://www.lfd.uci.edu/~gohlke/pythonlibs/" target="_blank" rel="noopener">python包下载</a></p></blockquote><p>下载对应python版本的文件，cp36表示3.6版本：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">basemap‑1.1.0‑cp36‑cp36m‑win_amd64.whl </span><br><span class="line">pyproj‑1.9.5.1‑cp36‑cp36m‑win_amd64.whl</span><br></pre></td></tr></table></figure><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>windows进入cmd模式，进入保存上述俩文件的路径，使用pip安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pyproj‑1.9.5.1‑cp36‑cp36m‑win_amd64.whl</span><br><span class="line">pip install basemap‑1.1.0‑cp36‑cp36m‑win_amd64.whl</span><br></pre></td></tr></table></figure></p><h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>打开简单的世界地图：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">from mpl_toolkits.basemap import Basemap</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(16, 8))</span><br><span class="line">m = Basemap()</span><br><span class="line">m.drawcoastlines()</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;python3.6安装basemap&lt;/p&gt;
&lt;p&gt;很久没碰matplotlib了，想看看有没有中国地图加人口，这样绘制一张图，找白天，貌似&lt;code&gt;basemap&lt;/code&gt;里面有，basemap需要：&lt;code&gt;from mpl_toolkits.basemap i
      
    
    </summary>
    
      <category term="python基础" scheme="http://tokyle.com/categories/python%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="matplotlib" scheme="http://tokyle.com/tags/matplotlib/"/>
    
  </entry>
  
  <entry>
    <title>【转】loadrunner请求三种格式API</title>
    <link href="http://tokyle.com/2018/05/22/%E3%80%90%E8%BD%AC%E3%80%91loadrunner%E8%AF%B7%E6%B1%82%E4%B8%89%E7%A7%8D%E6%A0%BC%E5%BC%8FAPI/"/>
    <id>http://tokyle.com/2018/05/22/【转】loadrunner请求三种格式API/</id>
    <published>2018-05-22T05:57:09.000Z</published>
    <updated>2018-05-22T05:59:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>loadrunner请求API，http POST三种请求格式的脚本</p><a id="more"></a><p>本篇文章主要针对POST请求的三种数据请求格式，组织不同的脚本:</p><p>（1）、application/x-www-form-urlencoded 键值对</p><p>（2）、multipart/form-data 表单</p><p>（3）、application/json Json串</p><p>PS：loadrunner body参数中的引号，需要自己加<code>\</code>转义。</p><h3 id="application-x-www-form-urlencoded-键值对"><a href="#application-x-www-form-urlencoded-键值对" class="headerlink" title="application/x-www-form-urlencoded 键值对"></a>application/x-www-form-urlencoded 键值对</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Action()  </span><br><span class="line">&#123;  </span><br><span class="line">    lr_start_transaction(&quot;checkPerson&quot;);  </span><br><span class="line">    /* 注册获取返回参数，该方法可以配合打印返回数据，检测数据内容 */  </span><br><span class="line">    web_reg_save_param(&quot;Para&quot;,  </span><br><span class="line">                       &quot;LB=&quot;,  </span><br><span class="line">                       &quot;RB=&quot;,  </span><br><span class="line">                       LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 注册断言： Text=断言内容 */  </span><br><span class="line">    /* 该方法会判断后面的web请求方法的返回值 */  </span><br><span class="line">    web_reg_find(&quot;Text=成功&quot;,  </span><br><span class="line">             LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 汉字进行UTF-8编码 */  </span><br><span class="line">    lr_convert_string_encoding(&quot;需要进行UTF-8加密的中文字符串&quot;,LR_ENC_SYSTEM_LOCALE,LR_ENC_UTF8,&quot;result&quot;);  </span><br><span class="line">  </span><br><span class="line">    /* 向后面的web请求函数增加请求头 */  </span><br><span class="line">    /* 如果web请求方法中已经设置了相同的头，则优先使用web请求方法中的头，例如web请求方法中的EncType参数，对应请求投中的Content-Type。由于下面的方法已经设置了EncType参数，所以这里的设置并没有什么X用 */  </span><br><span class="line">    /* 表单直接使用方法自带参数，键值对和json建议使用该方法 */  </span><br><span class="line">    web_add_header(&quot;Content-Type&quot;,  </span><br><span class="line">               &quot;application/x-www-form-urlencoded; charset=utf-8&quot;);  </span><br><span class="line">  </span><br><span class="line">    /* 主要针对form表单和键值对两种格式的web请求 */  </span><br><span class="line">    web_submit_data(&quot;checkPerson&quot;,  </span><br><span class="line">        &quot;Action=http://130.1.11.105:9080/ibis/faceService/checkPerson&quot;,  </span><br><span class="line">        &quot;Method=POST&quot;,  </span><br><span class="line">        /* 该方法支持常见的两种请求数据格式 */  </span><br><span class="line">        /* （1）&quot;EncType=multipart/form-data&quot;。form表单提交数据 */  </span><br><span class="line">        /* （1）&quot;EncType=application/x-www-form-urlencoded&quot;。默认使用键值对提交数据 */  </span><br><span class="line">        //&quot;EncType=&quot;,  </span><br><span class="line">        &quot;TargetFrame=&quot;,  </span><br><span class="line">        &quot;Referer=&quot;,  </span><br><span class="line">        ITEMDATA,  </span><br><span class="line">        &quot;Name=Name1&quot;, &quot;Value=Value1&quot;, ENDITEM,  </span><br><span class="line">        &quot;Name=Name2&quot;, &quot;Value=Value2&quot;, ENDITEM,  </span><br><span class="line">        LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 打印相应结果 */  </span><br><span class="line">    /* lr_eval_string(&quot;&#123;result&#125;&quot;) 使用loadrunner引用外部函数，只有这样才能取出上面web_reg_save_param方法的返回值 */  </span><br><span class="line">    lr_log_message(lr_eval_string(&quot;&#123;result&#125;&quot;));  </span><br><span class="line">  </span><br><span class="line">    lr_end_transaction(&quot;checkPerson&quot;, LR_AUTO);  </span><br><span class="line">  </span><br><span class="line">    return 0;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="multipart-form-data-表单"><a href="#multipart-form-data-表单" class="headerlink" title="multipart/form-data 表单"></a>multipart/form-data 表单</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Action()  </span><br><span class="line">&#123;  </span><br><span class="line">    lr_start_transaction(&quot;checkPerson&quot;);  </span><br><span class="line">    /* 注册获取返回参数，该方法可以配合打印返回数据，检测数据内容 */  </span><br><span class="line">    web_reg_save_param(&quot;Para&quot;,  </span><br><span class="line">                       &quot;LB=&quot;,  </span><br><span class="line">                       &quot;RB=&quot;,  </span><br><span class="line">                       LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 注册断言： Text=断言内容 */  </span><br><span class="line">    /* 该方法会判断后面的web请求方法的返回值 */  </span><br><span class="line">    web_reg_find(&quot;Text=成功&quot;,  </span><br><span class="line">             LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 汉字进行UTF-8编码 */  </span><br><span class="line">    lr_convert_string_encoding(&quot;需要进行UTF-8加密的中文字符串&quot;,LR_ENC_SYSTEM_LOCALE,LR_ENC_UTF8,&quot;result&quot;);  </span><br><span class="line">  </span><br><span class="line">    /* 向后面的web请求函数增加请求头 */  </span><br><span class="line">    /* 如果web请求方法中已经设置了相同的头，则优先使用web请求方法中的头，例如web请求方法中的EncType参数，对应请求投中的Content-Type。由于下面的方法已经设置了EncType参数，所以这里的设置并没有什么X用 */  </span><br><span class="line">    /* 表单直接使用方法自带参数，键值对和json建议使用该方法 */  </span><br><span class="line">    //web_add_header(&quot;Content-Type&quot;,  </span><br><span class="line">    //         &quot;multipart/form-data; boundary = --------BORN3QKNRTS4; charset=UTF-8&quot;);  </span><br><span class="line">  </span><br><span class="line">    /* 主要针对form表单和键值对两种格式的web请求 */  </span><br><span class="line">    web_submit_data(&quot;checkPerson&quot;,  </span><br><span class="line">        &quot;Action=http://130.1.11.105:9080/ibis/faceService/checkPerson&quot;,  </span><br><span class="line">        &quot;Method=POST&quot;,  </span><br><span class="line">        /* 该方法支持常见的两种请求数据格式 */  </span><br><span class="line">        /* （1）&quot;EncType=multipart/form-data&quot;。form表单提交数据 */  </span><br><span class="line">        /* （1）&quot;EncType=&quot;。默认使用键值对提交数据 */  </span><br><span class="line">        &quot;EncType=multipart/form-data&quot;,  </span><br><span class="line">        &quot;TargetFrame=&quot;,  </span><br><span class="line">        &quot;Referer=&quot;,  </span><br><span class="line">        ITEMDATA,  </span><br><span class="line">        &quot;Name=Name1&quot;, &quot;Value=Value1&quot;, ENDITEM,  </span><br><span class="line">        &quot;Name=Name2&quot;, &quot;Value=Value2&quot;, ENDITEM,  </span><br><span class="line">        LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 打印相应结果 */  </span><br><span class="line">    /* lr_eval_string(&quot;&#123;result&#125;&quot;) 使用loadrunner引用外部函数，只有这样才能取出上面web_reg_save_param方法的返回值 */  </span><br><span class="line">    lr_log_message(lr_eval_string(&quot;&#123;result&#125;&quot;));  </span><br><span class="line">  </span><br><span class="line">    lr_end_transaction(&quot;checkPerson&quot;, LR_AUTO);  </span><br><span class="line">  </span><br><span class="line">    return 0;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="application-json-Json串"><a href="#application-json-Json串" class="headerlink" title="application/json Json串"></a>application/json Json串</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Action()  </span><br><span class="line">&#123;  </span><br><span class="line">    lr_start_transaction(&quot;checkPerson&quot;);  </span><br><span class="line">    /* 注册获取返回参数，该方法可以配合打印返回数据，检测数据内容 */  </span><br><span class="line">    web_reg_save_param(&quot;Para&quot;,  </span><br><span class="line">                       &quot;LB=&quot;,  </span><br><span class="line">                       &quot;RB=&quot;,  </span><br><span class="line">                       LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 注册断言： Text=断言内容 */  </span><br><span class="line">    /* 该方法会判断后面的web请求方法的返回值 */  </span><br><span class="line">    // web_reg_find(&quot;Text=成功&quot;,  </span><br><span class="line">    //       LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 汉字进行UTF-8编码 */  </span><br><span class="line">    lr_convert_string_encoding(&quot;需要进行UTF-8加密的中文字符串&quot;,LR_ENC_SYSTEM_LOCALE,LR_ENC_UTF8,&quot;result&quot;);  </span><br><span class="line">  </span><br><span class="line">    /* 向后面的web请求函数增加请求头 */  </span><br><span class="line">    /* 如果web请求方法中已经设置了相同的头，则优先使用web请求方法中的头，例如web请求方法中的EncType参数，对应请求投中的Content-Type。由于下面的方法已经设置了EncType参数，所以这里的设置并没有什么X用 */  </span><br><span class="line">    /* 表单直接使用方法自带参数，键值对和json建议使用该方法 */  </span><br><span class="line">    web_add_header(&quot;Content-Type&quot;,  </span><br><span class="line">               &quot;application/json; charset=UTF-8&quot;);  </span><br><span class="line">  </span><br><span class="line">    /* 主要针对form表单和键值对两种格式的web请求 */  </span><br><span class="line">  </span><br><span class="line">    web_custom_request(&quot;web_custom_request&quot;,  </span><br><span class="line">        &quot;URL=http://www.baidu.com&quot;,  </span><br><span class="line">        &quot;Method=POST&quot;,  </span><br><span class="line">        &quot;TargetFrame=&quot;,  </span><br><span class="line">        &quot;Resource=0&quot;,  </span><br><span class="line">        &quot;Referer=&quot;,  </span><br><span class="line">        &quot;Mode=HTTP&quot;,  </span><br><span class="line">        /* json和键值对数据格式，建议使用web_add_header方法添加Content-Type头 */  </span><br><span class="line">        //&quot;EncType=application/json&quot;,  </span><br><span class="line">        &quot;Body=&#123;\&quot;Name1\&quot;:\&quot;Value1\&quot;,\&quot;Name2\&quot;:\&quot;Value2\&quot;&#125;&quot;,  </span><br><span class="line">        LAST);  </span><br><span class="line">  </span><br><span class="line">    /* 打印相应结果 */  </span><br><span class="line">    /* lr_eval_string(&quot;&#123;result&#125;&quot;) 使用loadrunner引用外部函数，只有这样才能取出上面web_reg_save_param方法的返回值 */  </span><br><span class="line">    lr_log_message(lr_eval_string(&quot;&#123;result&#125;&quot;));  </span><br><span class="line">  </span><br><span class="line">    lr_end_transaction(&quot;checkPerson&quot;, LR_AUTO);  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    return 0;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;loadrunner请求API，http POST三种请求格式的脚本&lt;/p&gt;
    
    </summary>
    
      <category term="性能测试" scheme="http://tokyle.com/categories/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="loadrunner" scheme="http://tokyle.com/tags/loadrunner/"/>
    
  </entry>
  
  <entry>
    <title>【转】windows性能监控指标</title>
    <link href="http://tokyle.com/2018/05/16/%E3%80%90%E8%BD%AC%E3%80%91windows%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87/"/>
    <id>http://tokyle.com/2018/05/16/【转】windows性能监控指标/</id>
    <published>2018-05-16T06:40:11.000Z</published>
    <updated>2018-05-16T06:50:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>使用loadrunner进行性能测试，需要监控服务器，当IIS和sqlserver位于windows服务器时，就需要使用windows自带的性能监控工具进行性能数据收集，之后进行分析，以下为各指标详解：</p><a id="more"></a><h3 id="内存分析"><a href="#内存分析" class="headerlink" title="内存分析"></a>内存分析</h3><p>内存分析需要使用的计数器：Memory性能对象和Physical Disk性能对象的计数器。<br>内存分析的主要方法和步骤：</p><h4 id="查看Memory-gt-Available-Mbytes指标"><a href="#查看Memory-gt-Available-Mbytes指标" class="headerlink" title="查看Memory-&gt;Available Mbytes指标"></a>查看Memory-&gt;Available Mbytes指标</h4><h5 id="Available-Mbytes："><a href="#Available-Mbytes：" class="headerlink" title="Available Mbytes："></a>Available Mbytes：</h5><p>描述：<br>Available MBytes 指能立刻分配给一个进程或系统使用的物理内存数量，以 MB 为单位表示。它等于分配给待机(缓存的)、空闲和零分页列表内存的总和。<br>建议指标：<br>该值不宜低于<strong>400</strong>。一般要保留10%的可用内存，假设系统有8G内存，则该值最好不要低于800M<br>说明：<br>过高说明内存资源即将耗尽，应考虑增加内存<br>如果该指标的数据比较小，系统可能出现了内存方面的问题，需要继续下面步骤进一步分析</p><h4 id="注意Memory-gt-Pages-sec、Memory-gt-Page-Reads-sec和Memory-gt-Page-Fault-sec的值"><a href="#注意Memory-gt-Pages-sec、Memory-gt-Page-Reads-sec和Memory-gt-Page-Fault-sec的值" class="headerlink" title="注意Memory-&gt;Pages/sec、Memory-&gt;Page Reads/sec和Memory-&gt;Page Fault/sec的值"></a>注意Memory-&gt;Pages/sec、Memory-&gt;Page Reads/sec和Memory-&gt;Page Fault/sec的值</h4><p>操作系统会利用磁盘较好的方式提高系统可用内存量或者提高内存的使用效率。这三个指标直接反应了操作系统进行磁盘交换的频度 </p><h5 id="Pages-sec："><a href="#Pages-sec：" class="headerlink" title="Pages/sec："></a>Pages/sec：</h5><p>描述：<br>Pages/sec 是指为解决硬页错误从磁盘读取或写入磁盘的速度。这个计数器是可以显示导致系统范围延缓类型错误的主要指示器。它是 Memory\Pages Input/sec 和 Memory\Pages Output/sec 的总和。是用页数计算的，以便在不用做转换的情况下就可以同其他页计数如: Memory\Page Faults/sec 做比较，这个值包括为满足错误而在文件系统缓存(通常由应用程序请求)的非缓存映射内存文件中检索的页<br>建议指标：<br>该值不宜超过<strong>20 </strong><br>说明：<br>此值持续高于几百，说明内存中有很多东西需要与硬盘交换，可能有内存问题，应考虑增加内存或更换内存 </p><h5 id="Page-Fault-sec："><a href="#Page-Fault-sec：" class="headerlink" title="Page Fault/sec："></a>Page Fault/sec：</h5><p>说明：<br>每秒发生页面失效次数，页面失效次数越多，说明操作系统向内存读取的次数越多。此时需要查看Page Reads/sec的计数值，该计数器的阀值为<strong>5</strong>，如果计数值超过5，则可以判断存在内存方面的问题。</p><p>根据Physical Disk性能对象的计数器值分析性能瓶颈<br>对Physical Disk计数器对象的分析包括对Page Reads/sec和%Disk Time及Average Disk Queue Length的分析。如果Page Reads/sec很低，同时%Disk Time和Average Disk Queue Length的值很高，则可能有磁盘瓶颈。但是队列长度增加的同时Page Reads/sec并未降低，则是内存不足</p><h4 id="内存计数器阀值"><a href="#内存计数器阀值" class="headerlink" title="内存计数器阀值"></a>内存计数器阀值</h4><h5 id="Memory-gt-Available-Bytes"><a href="#Memory-gt-Available-Bytes" class="headerlink" title="Memory-&gt;Available Bytes"></a>Memory-&gt;Available Bytes</h5><p>建议的阀值：<br>对于具有较大内存的计算机&gt;=10%可用空间<br>对于较小内存也需要大于4MB空间可用<br>说明：<br>Available Bytes剩余的可用物理内存，单位是兆字节，表明进程当前可使用的内存字节数</p><h5 id="Memory-gt-Pages-sec"><a href="#Memory-gt-Pages-sec" class="headerlink" title="Memory-&gt;Pages/sec"></a>Memory-&gt;Pages/sec</h5><p>建议的阀值：<br>Pages/sec&lt;=<strong>20</strong><br>说明：<br>操作系统经常会利用磁盘交换的方式提高系统的可用的内存量或是提高内存的使用效率。<br>Pages/sec是指为解决硬页错误从磁盘读取或写入磁盘的速度。这个计数器是可以显示导致系统范围延缓类型错误的主要计数器。它是Memory-&gt;Pages Input/sec和Pages Output/sec的总和。是用页数计算的，以便在不同做转换的情况下就可以同其他页计数，如：Memory-&gt;Pages Fault/sec做比较，这个值包括为错误而在文件系统缓存（通常由应用程序请求）的非缓存映射内存文件中检索的页。如果Pages/sec的值为20或更大，应进一步研究页交换活动。Pages/sec的值很大不一定表明内存有问题，而可能是运行使用内存映射文件的程序所致</p><h5 id="Memory-gt-Page-Faults-sec"><a href="#Memory-gt-Page-Faults-sec" class="headerlink" title="Memory-&gt;Page Faults/sec"></a>Memory-&gt;Page Faults/sec</h5><p>建议的阀值：<br><strong>5</strong><br>说明： </p><h5 id="Page-Fault-sec"><a href="#Page-Fault-sec" class="headerlink" title="Page Fault/sec"></a>Page Fault/sec</h5><p>Page Fault/sec值在这个进程中执行线程造成的页面错误出现的速度。当线程引用了不在主内存工作集中的虚拟内存页即会出现Page Fault。如果它在备用表中（即已经在主内存中）或另一个共享页的处理正在使用它，就会无法从磁盘中获取页</p><h5 id="Paging-File-gt-Usage"><a href="#Paging-File-gt-Usage" class="headerlink" title="Paging File-&gt;%Usage"></a>Paging File-&gt;%Usage</h5><p>建议的阀值：<br>70%以上<br>说明：<br>与Available Bytes和Pages/sec一起复查该值，了解计算机的页交换活动</p><h3 id="CPU监控"><a href="#CPU监控" class="headerlink" title="CPU监控"></a>CPU监控</h3><p>首先看<code>System-&gt;%Total Processor Time</code>性能计数器的计数值<br>该计数器的值体现服务器整体处理器利用率，对多处理器的系统而言，该计数器提醒所有CPU的平均利用率。如果该值持续超过<strong>90%</strong>，则说明整个系统面临着处理器方面的瓶颈，需要通过增加处理器来提高性能 </p><h5 id="Total-Processor-Time："><a href="#Total-Processor-Time：" class="headerlink" title="%Total Processor Time："></a>%Total Processor Time：</h5><p>描述：<br><strong>% Processor Time</strong> 指处理器用来执行非闲置线程时间的百分比。计算方法是，度量处理器用来执行空闲线程的时间，然后用 100% 减去该值。(每个处理器有一个空闲线程，该线程在没有其他线程可以运行时消耗周期)。此计数器是处理器活动的主要指示器，显示在采样间隔期间所观察的繁忙时间平均百分比。应注意，对处理器是否空闲的计算是在系统时钟的内部采样间隔期间(10ms)执行的。考虑到现在的处理器速度非常快，因此，在处理器可能会用大量时间为系统时钟采样间隔之间的线程提供服务时，% Processor Time 会低估处理器利用率。当恰好进行采样后即向计时器发出信号时，更可能对应用程序做出不准确地度量，基于工作负荷的计时器应用程序是一个这样的示例。<br>建议指标：<br>该监控内容不宜超过<strong>80%</strong><br>说明：<br>过高说明CPU资源即将耗尽，应增加CPU资源或实施分布式策略</p><p>查看每个CPU的Processor-&gt;%Processor Time和Processor-&gt;%User<br>Time和Processor-&gt;%Privileged Time<br>Processor-&gt;%User Time是系统非核心操作消耗的CPU时间，如果该值较大，可以考虑是否能够通过友好算法等方法降低这个值。如果该服务器时数据库服务器，Processor-&gt;%User Time值较大的原因很可能是数据库的排序或是函数操作消耗了过多的CPU时间，此时可以考虑对数据库系统进行优化</p><p>研究系统处理器瓶颈<br>查看<code>System-&gt;Processor Queue Length</code>计数器的值，当该计数器的值大于<strong>CPU数量的总数+1</strong>时，说明产生了处理器阻塞。在处理器的%Process Time很高时，一般都是处理器阻塞，但产生处理器阻塞时，<strong>Processor-&gt;%Process Time计数器的值不一定很大，此时就必须查找阻塞的原因</strong></p><h4 id="CPU计数器阀值"><a href="#CPU计数器阀值" class="headerlink" title="CPU计数器阀值"></a>CPU计数器阀值</h4><h5 id="Processor-gt-Processor-Time"><a href="#Processor-gt-Processor-Time" class="headerlink" title="Processor-&gt;%Processor Time"></a>Processor-&gt;%Processor Time</h5><p>建议的阀值：<br><strong>85%</strong><br>说明：<br>查找占用处理器时间高百分比的进程。升级到更快的处理器或安装其他处理器</p><p>Processor-&gt;Interrupts/sec<br>建议的阀值：<br>取决于处理器，每秒1000次中断是好的起点<br>说明：<br>此计数器的值是明显增加，而系统活动没有相应的增加则表明存在硬件问题。确定引起中断的网络适配器、磁盘或者其他硬件</p><h5 id="Server-gt-Bytes-Total-sec"><a href="#Server-gt-Bytes-Total-sec" class="headerlink" title="Server-&gt;Bytes Total/sec"></a>Server-&gt;Bytes Total/sec</h5><p>建议的阀值：<br>/<br>说明：<br>如果所有的服务器Bytes Total/sec和与网络的最大传送速度几乎相等，则可能需要将网络分段</p><h5 id="Server-gt-Work-Item-Shortages"><a href="#Server-gt-Work-Item-Shortages" class="headerlink" title="Server-&gt;Work Item Shortages"></a>Server-&gt;Work Item Shortages</h5><p>建议的阀值：<br><strong>3</strong><br>说明：<br>如果值达到该阀值，请考虑将DWORD项InitWorkItems（在启动期间分配给处理器的工作项数）或者MaxWorkItems（服务器可以分配的接收缓冲区的最大数）添加到注册表（在HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters 下面）。项InitWorkItems的范围可以是从1到512，同时MaxWorkItems的范围可以是从1到65535。以InitWorkItems的任何值以及MaxWorkItems的值4096开始，并一直加倍这些值，直到Server-&gt;Work Item Shortages阀值低于3</p><h5 id="Server-gt-Pool-Paged-Peak"><a href="#Server-gt-Pool-Paged-Peak" class="headerlink" title="Server-&gt;Pool Paged Peak"></a>Server-&gt;Pool Paged Peak</h5><p>建议的阀值：<br>物理RAM的数量<br>说明：<br>此值是最大页面文件大小和物理内存数量的指示器</p><h5 id="Server-Work-Queue-gt-Queue-Length"><a href="#Server-Work-Queue-gt-Queue-Length" class="headerlink" title="Server Work Queue-&gt;Queue Length"></a>Server Work Queue-&gt;Queue Length</h5><p>建议的阀值：<br><strong>4</strong><br>说明：<br>如果值达到此阀值，则可能存在处理器瓶颈。这是即时计数器；观察在多个间隔上的值</p><h3 id="磁盘监控"><a href="#磁盘监控" class="headerlink" title="磁盘监控"></a>磁盘监控</h3><p>与Processor-&gt;Privieged Time合并进行分析<br>如果在<code>Physical Disk</code>计数器中，只有<code>%Disk Time</code>比较大，其他值都比较适中，硬盘可能会是瓶颈。若几个值都比较大，且数值持续超过<strong>80%</strong>，则可能是<strong>内存泄露</strong></p><h5 id="PhysicalDisk-Total-Disk-Time："><a href="#PhysicalDisk-Total-Disk-Time：" class="headerlink" title="\PhysicalDisk(_Total)\% Disk Time："></a>\PhysicalDisk(_Total)\% Disk Time：</h5><p>描述：<br>Disk Time 指所选磁盘驱动器忙于为读或写入请求提供服务所用的时间的百分比。<br>建议指标：<br>此值不宜超过<strong>10</strong><br>说明：<br>此值过高，说明硬盘响应效率较低，应换用更高性能的硬盘</p><p>根据<strong>Disk Transfers/sec</strong>进行分析<br>一般来说，定义该数值小于15ms为优秀，介于15~30ms之间为良好，30~60之间为可接受，超过<strong>60ms</strong>则需要考虑更换或是硬盘的RAID方式</p><p>磁盘计数器阀值</p><h5 id="Physical-Disk-gt-Free-Space和Logical-Disk-gt-Free-Space"><a href="#Physical-Disk-gt-Free-Space和Logical-Disk-gt-Free-Space" class="headerlink" title="Physical Disk-&gt;%Free Space和Logical Disk-&gt;%Free Space"></a>Physical Disk-&gt;%Free Space和Logical Disk-&gt;%Free Space</h5><p>建议的阀值：<br><strong>15%</strong></p><h5 id="Physical-Disk-gt-Disk-Time和Logical-Disk-gt-Disk-Time"><a href="#Physical-Disk-gt-Disk-Time和Logical-Disk-gt-Disk-Time" class="headerlink" title="Physical Disk-&gt;%Disk Time和Logical Disk-&gt;%Disk Time"></a>Physical Disk-&gt;%Disk Time和Logical Disk-&gt;%Disk Time</h5><p>建议的阀值：<br><strong>90%</strong></p><h5 id="Physical-Disk-gt-Disk-Reads-sec和Physical-Disk-gt-Disk-Writes-sec"><a href="#Physical-Disk-gt-Disk-Reads-sec和Physical-Disk-gt-Disk-Writes-sec" class="headerlink" title="Physical Disk-&gt;Disk Reads/sec和Physical Disk-&gt;Disk Writes/sec"></a>Physical Disk-&gt;Disk Reads/sec和Physical Disk-&gt;Disk Writes/sec</h5><p>建议的阀值：<br>取决于制造商的规格<br>说明：<br>检查磁盘的指定传送速度，以验证此速度没有超过规格。通常，Ultra Wide<br>SCSI磁盘每秒可以处理50到70次I/O操作。注意，无论I/O是顺序的还是随机的，都会对磁盘的每秒读写速率产生很大的影响</p><h5 id="Physical-Disk-gt-Current-Disk-Queue-Length"><a href="#Physical-Disk-gt-Current-Disk-Queue-Length" class="headerlink" title="Physical Disk-&gt;Current Disk Queue Length"></a>Physical Disk-&gt;Current Disk Queue Length</h5><p>建议的阀值：<br><strong>主轴数+2</strong><br>说明：<br>这是即时计数器，观察在多个间隔上的值。对于随时间变化的平均值，可试用Physicial Disk-&gt;Avg.Disk Queue Length</p><h2 id="进程分析方法"><a href="#进程分析方法" class="headerlink" title="进程分析方法"></a>进程分析方法</h2><h3 id="查看进程的Process-gt-Processor-Time值"><a href="#查看进程的Process-gt-Processor-Time值" class="headerlink" title="查看进程的Process-&gt;%Processor Time值"></a>查看进程的Process-&gt;%Processor Time值</h3><p>每个进程的%Processor Time反映进程所消耗的处理器时间。用不同进程所消耗的处理器时间进行对比，可以看出具体哪个进程在性能测试过程中消耗了最多的处理器时间，从而可以据此对应用进行优化</p><h3 id="查看每个进程产生的页面失效、"><a href="#查看每个进程产生的页面失效、" class="headerlink" title="查看每个进程产生的页面失效、"></a>查看每个进程产生的页面失效、</h3><p>可以用每个进程产生的页面失效（通过Process-&gt;Page Faults/sec计数器获得）和系统页面失效（通过Memory-&gt;Page Faults/sec计数器获得）的比值，来判断哪个进程产生了最多的页面失效，这个进程要么是需要大量内存的进程，要么是非常活跃的进程，可以对其进行重点分析</p><h3 id="了解进程的Process-gt-Private-Bytes"><a href="#了解进程的Process-gt-Private-Bytes" class="headerlink" title="了解进程的Process-&gt;Private Bytes"></a>了解进程的Process-&gt;Private Bytes</h3><p>Process-&gt;Private Bytes是指进程所分配的无法与其进程共享的当前字节数量。该计数器主要用来判断在性能测试过程中有无内存泄露。例如：对于一个IIS之上的Web应用，可以重点监控inetinfo进程的Private Bytes。如果在性能测试过程中，该进程的Private Bytes计数器值不断增加，或是性能测试停止一段时间，该进程的Private Bytes仍持续在高水平，则说明应用存在内存泄露</p><h2 id="网络分析方法"><a href="#网络分析方法" class="headerlink" title="网络分析方法"></a>网络分析方法</h2><h3 id="Network-Interface-gt-Bytes-Total-sec"><a href="#Network-Interface-gt-Bytes-Total-sec" class="headerlink" title="Network Interface-&gt;Bytes Total/sec"></a>Network Interface-&gt;Bytes Total/sec</h3><p>发送和接收字节的速率，可以通过该计数器值来判断网络链接速度是否是瓶颈，具体操作方法是用该计数器的值和当前网络的带宽进行比较</p><h3 id="与Processor-gt-Privileged-Time合并进行分析"><a href="#与Processor-gt-Privileged-Time合并进行分析" class="headerlink" title="与Processor-&gt;Privileged Time合并进行分析"></a>与Processor-&gt;Privileged Time合并进行分析</h3><p>如果在Physical Disk计数器中，只有%Disk Time比较大，其他值都比较适中，硬盘可能会是瓶颈。若几个值都比较大，且数值持续超过80%，则可能是内存泄露。</p><h2 id="ASP-NET监控"><a href="#ASP-NET监控" class="headerlink" title="ASP.NET监控"></a>ASP.NET监控</h2><h3 id="Request-Wait-Time"><a href="#Request-Wait-Time" class="headerlink" title="Request Wait Time"></a>Request Wait Time</h3><p>地址：<br>\ASP.NET\Request Wait Time<br>描述：<br>最近的请求在队列中等待的毫秒数。<br>建议指标：<br>此值不宜超过<strong>10000</strong><br>说明：<br>此值过高说明IIS已经无法承受更多的请求，应考虑实施分布式策略</p><blockquote><p><a href="https://blog.csdn.net/lluozh2015/article/details/50755480" target="_blank" rel="noopener">原文地址</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用loadrunner进行性能测试，需要监控服务器，当IIS和sqlserver位于windows服务器时，就需要使用windows自带的性能监控工具进行性能数据收集，之后进行分析，以下为各指标详解：&lt;/p&gt;
    
    </summary>
    
      <category term="性能测试" scheme="http://tokyle.com/categories/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="性能" scheme="http://tokyle.com/tags/%E6%80%A7%E8%83%BD/"/>
    
      <category term="windows" scheme="http://tokyle.com/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>centos7搭建zabbix</title>
    <link href="http://tokyle.com/2018/05/11/centos7%E6%90%AD%E5%BB%BAzabbix/"/>
    <id>http://tokyle.com/2018/05/11/centos7搭建zabbix/</id>
    <published>2018-05-11T09:31:11.000Z</published>
    <updated>2018-05-11T09:32:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>centos7搭建zabbix3.4</p><a id="more"></a><p>zabbix安装环境要求：</p><blockquote><p><a href="https://www.zabbix.com/documentation/3.4/zh/manual/installation/requirements" target="_blank" rel="noopener">zabbix安装要求</a></p></blockquote><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><h3 id="前置操作"><a href="#前置操作" class="headerlink" title="前置操作"></a>前置操作</h3><p>关闭selinux<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sed -i &quot;s/SELINUX=enforcing/SELINUX=disabled/g&quot; /etc/selinux/config</span><br></pre></td></tr></table></figure></p><p>升级yum<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y update</span><br></pre></td></tr></table></figure></p><h3 id="切换iptables防火墙"><a href="#切换iptables防火墙" class="headerlink" title="切换iptables防火墙"></a>切换iptables防火墙</h3><p>查看防火墙状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd    --state</span><br></pre></td></tr></table></figure></p><p>关闭防火墙<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl  stop   firewalld.service</span><br></pre></td></tr></table></figure></p><p>禁止开机启动启动防火墙<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl   disable   firewalld.service</span><br></pre></td></tr></table></figure></p><p><strong>iptables设置</strong><br>安装iptables服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install  iptables-services</span><br></pre></td></tr></table></figure></p><p>开启iptables防火墙<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl  start  iptables.service</span><br></pre></td></tr></table></figure></p><p>开启特定端口：<br>编辑文件：/etc/sysconfig/iptables，加入想要开放的端口即可，例如开放10051端口：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-A INPUT -p tcp -m tcp --dport 8090 -j ACCEPT</span><br></pre></td></tr></table></figure></p><p>保存退出，重启防火墙：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl  restart  iptables.service</span><br></pre></td></tr></table></figure></p><h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><p>下载源包：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm</span><br></pre></td></tr></table></figure></p><p>安装mysql源:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall mysql57-community-release-el7-8.noarch.rpm</span><br></pre></td></tr></table></figure></p><p>检查是否安装成功：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql-connectors-community/x86_64 MySQL Connectors Community                  51</span><br><span class="line">mysql-tools-community/x86_64      MySQL Tools Community                       63</span><br><span class="line">mysql57-community/x86_64          MySQL 5.7 Community Server                 267</span><br></pre></td></tr></table></figure><p>可以修改源配置，安装你喜欢的版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/mysql-community.repo</span><br></pre></td></tr></table></figure></p><p>只需要把对应的enable改成1即可。<br><strong>安装</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure></p><p>启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br><span class="line">systemctl status mysqld#查看状态</span><br></pre></td></tr></table></figure></p><p>配置开机启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable mysqld</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure></p><h4 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h4><p>查看默认密码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &apos;temporary password&apos; /var/log/mysqld.log</span><br></pre></td></tr></table></figure></p><p>修改密码很简单，mysql -uroot -p进入控制台，修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;yourpwd&apos;;</span><br></pre></td></tr></table></figure></p><p>修改权限：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;pwd&apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure></p><p>配置防火墙，开放3306端口，即可在windows使用工具连接数据库。</p><h3 id="安装Apache"><a href="#安装Apache" class="headerlink" title="安装Apache"></a>安装Apache</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install httpd</span><br><span class="line">systemctl start httpd.service #启动</span><br><span class="line">systemctl enable httpd.service #开机启动</span><br></pre></td></tr></table></figure><h3 id="安装php"><a href="#安装php" class="headerlink" title="安装php"></a>安装php</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install php</span><br></pre></td></tr></table></figure><h4 id="安装php扩展"><a href="#安装php扩展" class="headerlink" title="安装php扩展"></a>安装php扩展</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install php-mysqlnd php-gd libjpeg* php-snmp php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-bcmath php-mhash php-common php-ctype php-xml php-xmlreader php-xmlwriter php-session php-mbstring php-gettext php-ldap php-mysqli --skip-broken</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install wget telnet net-tools python-paramiko gcc gcc-c++ dejavu-sans-fonts python-setuptools python-devel sendmail mailx net-snmp net-snmp-devel net-snmp-utils freetype-devel libpng-devel perl unbound libtasn1-devel p11-kit-devel OpenIPMI unixODBC</span><br></pre></td></tr></table></figure><h3 id="修改一些配置"><a href="#修改一些配置" class="headerlink" title="修改一些配置"></a>修改一些配置</h3><h4 id="设置MySQL参数"><a href="#设置MySQL参数" class="headerlink" title="设置MySQL参数"></a>设置MySQL参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure><p>在文件最后添加以下内容（8G内存为例，根据自己配置适当修改）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_status_file = 1</span><br><span class="line">innodb_buffer_pool_size = 6G</span><br><span class="line">innodb_flush_log_at_trx_commit = 2</span><br><span class="line">innodb_log_buffer_size = 16M</span><br><span class="line">innodb_log_file_size = 64M</span><br><span class="line">innodb_support_xa = 0</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">bulk_insert_buffer_size = 8M</span><br><span class="line">join_buffer_size = 16M</span><br><span class="line">max_heap_table_size = 32M</span><br><span class="line">tmp_table_size = 32M</span><br><span class="line">max_tmp_tables = 48</span><br><span class="line">read_buffer_size = 32M</span><br><span class="line">read_rnd_buffer_size = 16M</span><br><span class="line">key_buffer_size = 32M</span><br><span class="line">thread_cache_size = 32</span><br><span class="line">innodb_thread_concurrency = 8</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_rollback_on_timeout = 1</span><br><span class="line">query_cache_size = 16M</span><br><span class="line">query_cache_limit = 16M</span><br><span class="line">collation_server = utf8_bin</span><br><span class="line">character_set_server = utf8</span><br></pre></td></tr></table></figure></p><p>注：原则上 innodb_buffer_pool_size 需要设置为主机内存的 80%，如果主机内存不是 8GB，以上参数可依据相应比例进行调整，例如主机内存为 16GB，则 innodb_buffer_pool_size 建议设置为 12GB，innodb_log_buffer_size 建议设置为 32M，innodb_log_file_size 建议设置为 128M，以此类推。请注意innodb_buffer_pool_size的值必须是整数，例如主机内存是4G，那么innodb_buffer_pool_size可以设置为3G，而不能设置为3.2G</p><p>重启MySQL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure></p><h4 id="创建zabbix数据库用户"><a href="#创建zabbix数据库用户" class="headerlink" title="创建zabbix数据库用户"></a>创建zabbix数据库用户</h4><p>进入mysql控制台<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create database zabbix character set utf8;</span><br><span class="line">create user zabbix@&apos;%&apos; identified by &apos;yourpwd&apos;;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;zabbix&apos;@&apos;%&apos; IDENTIFIED BY &apos;yourpwd&apos; WITH GRANT OPTION;</span><br><span class="line">flush privileges;</span><br><span class="line">exit;</span><br></pre></td></tr></table></figure><h3 id="安装zabbix源"><a href="#安装zabbix源" class="headerlink" title="安装zabbix源"></a>安装zabbix源</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -ivh http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br></pre></td></tr></table></figure><h3 id="安装zabbix"><a href="#安装zabbix" class="headerlink" title="安装zabbix"></a>安装zabbix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-java-gateway zabbix-web</span><br></pre></td></tr></table></figure><h3 id="配置zabbix"><a href="#配置zabbix" class="headerlink" title="配置zabbix"></a>配置zabbix</h3><h4 id="导入zabbix所需信息"><a href="#导入zabbix所需信息" class="headerlink" title="导入zabbix所需信息"></a>导入zabbix所需信息</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/share/doc/zabbix-server-mysql-3.4.3</span><br><span class="line">zcat create.sql.gz | mysql -uroot zabbix -p</span><br></pre></td></tr></table></figure><h4 id="配置zabbix参数"><a href="#配置zabbix参数" class="headerlink" title="配置zabbix参数"></a>配置zabbix参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/zabbix/zabbix_server.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">DBPassword=yourpwd</span><br><span class="line">(125行左右)</span><br><span class="line"></span><br><span class="line">CacheSize=512M</span><br><span class="line">（在385行左右）</span><br><span class="line"></span><br><span class="line">HistoryCacheSize=128M</span><br><span class="line">（在410行左右）</span><br><span class="line"></span><br><span class="line">HistoryIndexCacheSize=128M</span><br><span class="line">（在419行左右）</span><br><span class="line"></span><br><span class="line">TrendCacheSize=128M</span><br><span class="line">（在428行左右）</span><br><span class="line"></span><br><span class="line">ValueCacheSize=256M</span><br><span class="line">（在438行左右）</span><br><span class="line"></span><br><span class="line">Timeout=30</span><br><span class="line">（在448行左右）</span><br></pre></td></tr></table></figure><h4 id="配置Apache中的php参数"><a href="#配置Apache中的php参数" class="headerlink" title="配置Apache中的php参数"></a>配置Apache中的php参数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/httpd/conf.d/zabbix.conf</span><br><span class="line"></span><br><span class="line">php_value max_execution_time 600</span><br><span class="line">php_value memory_limit 256M</span><br><span class="line">php_value post_max_size 32M</span><br><span class="line">php_value upload_max_filesize 32M</span><br><span class="line">php_value max_input_time 600</span><br><span class="line">php_value always_populate_raw_post_data -1</span><br><span class="line">date.timezone 去掉注释符号#，并将值修改为 Asia/Shanghai</span><br></pre></td></tr></table></figure><h4 id="重启系统"><a href="#重启系统" class="headerlink" title="重启系统"></a>重启系统</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure><h3 id="启动zabbix"><a href="#启动zabbix" class="headerlink" title="启动zabbix"></a>启动zabbix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start httpd &amp;&amp; systemctl start zabbix-server</span><br></pre></td></tr></table></figure><p>在浏览器中输入<code>http://your_IP/zabbix</code>，进入zabbix页面进行初始化配置，单击两次<code>next step</code>，填写正确数据库信息，继续<code>next step</code>，填写zabbix detail（相当于起名字），端口不变！！！然后<code>finish</code>，完成安装。</p><h3 id="设置中文"><a href="#设置中文" class="headerlink" title="设置中文"></a>设置中文</h3><p>第一次登录zabbix监控系统，默认用户为<code>admin</code>，默认密码<code>zabbix</code>，正确登录系统。<br>选择<code>Administrator –&gt; Users –&gt; Admin</code>，在<code>Language</code>栏选择<code>Chinese(zh_CN)</code>完成汉化。</p><p>OVER!</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><blockquote><p><a href="https://www.centos.bz/2017/11/centos-7%E5%AE%89%E8%A3%85zabbix-3-4/" target="_blank" rel="noopener">centos7安装zabbix3.4</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;centos7搭建zabbix3.4&lt;/p&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="Centos7" scheme="http://tokyle.com/tags/Centos7/"/>
    
      <category term="Zabbiz3.4" scheme="http://tokyle.com/tags/Zabbiz3-4/"/>
    
  </entry>
  
  <entry>
    <title>centos部署.net core</title>
    <link href="http://tokyle.com/2018/05/10/centos%E9%83%A8%E7%BD%B2-net-core/"/>
    <id>http://tokyle.com/2018/05/10/centos部署-net-core/</id>
    <published>2018-05-10T09:20:07.000Z</published>
    <updated>2018-05-10T09:21:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>Centos7部署.net core应用<br><a id="more"></a></p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="dotnet产品提要"><a href="#dotnet产品提要" class="headerlink" title="dotnet产品提要"></a>dotnet产品提要</h4><p>首先需要注册Microsoft签名密钥并添加Microsoft产品提要，才能安装.net<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --import https://packages.microsoft.com/keys/microsoft.asc</span><br><span class="line">sh -c &apos;echo -e &quot;[packages-microsoft-com-prod]\nname=packages-microsoft-com-prod \nbaseurl= https://packages.microsoft.com/yumrepos/microsoft-rhel7.3-prod\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot; &gt; /etc/yum.repos.d/dotnetdev.repo&apos;</span><br></pre></td></tr></table></figure></p><p>默认使用<code>root</code>用户操作</p><h4 id="安装-NET-SDK"><a href="#安装-NET-SDK" class="headerlink" title="安装.NET SDK"></a>安装.NET SDK</h4><p>首先更新yum<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br></pre></td></tr></table></figure></p><p>安装所需组件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install libunwind libicu</span><br></pre></td></tr></table></figure></p><p>安装.NET SDK<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install dotnet-sdk-2.1.200</span><br></pre></td></tr></table></figure></p><p>完成安装，<code>dotnet --version</code>验证安装</p><h3 id="部署应用"><a href="#部署应用" class="headerlink" title="部署应用"></a>部署应用</h3><p>将你的.net core应用随意放置在某个目录，进入目录，执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet YourApp.WebApi.dll</span><br></pre></td></tr></table></figure></p><p>即可启动服务，默认启动端口为5000.</p><h4 id="nginx代理"><a href="#nginx代理" class="headerlink" title="nginx代理"></a>nginx代理</h4><h5 id="安装nginx"><a href="#安装nginx" class="headerlink" title="安装nginx"></a>安装nginx</h5><p>安装nginx需要添加EPEL仓库，然后再安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum install nginx</span><br></pre></td></tr></table></figure></p><h5 id="启动nginx"><a href="#启动nginx" class="headerlink" title="启动nginx"></a>启动nginx</h5><p>启动：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure></p><h5 id="设置nginx开机启动"><a href="#设置nginx开机启动" class="headerlink" title="设置nginx开机启动"></a>设置nginx开机启动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><h5 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h5><p>将nginx的默认配置文件中的80端口内容注释掉，文件路径：<code>/etc/nginx/nginx.conf</code>,然后在nginx的配置加载目录下创建你需要代理的端口配置文件<code>yourapp.conf</code>，路径：<code>/etc/nginx/conf.d</code>，文件内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://localhost:5000;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection keep-alive;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_cache_bypass $http_upgrade;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>重启nginx即可通过80端口访问部署的.net core服务。</p><h3 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h3><p>由于安装在linux上，不同于windows，出现了一个现象，页面进行请求之后，消息队列中的消息一直无法被消费，查看日志，显示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">The handler does not support custom handling of certificates with this combination of libcurl (7.29.0) and its SSL backend (&quot;NSS/3.28.4&quot;).) ---&gt; System.PlatformNotSupportedException: The handler does not support custom handling of certificates with this combination of libcurl (7.29.0) and its SSL backend (&quot;NSS/3.28.4&quot;).</span><br><span class="line">at System.Net.Http.CurlHandler.SslProvider.SetSslOptionsForUnsupportedBackend(EasyRequest easy, ClientCertificateProvider certProvider)</span><br><span class="line">at System.Net.Http.CurlHandler.SslProvider.SetSslOptions(EasyRequest easy, ClientCertificateOption clientCertOption</span><br></pre></td></tr></table></figure></p><p>原因就是linux不支持ssl（貌似是这样），搜了一堆答案，大部分是建议升级<code>curl</code></p><h4 id="解决linux-netcore-https请求使用自签名证书忽略安全检查方法"><a href="#解决linux-netcore-https请求使用自签名证书忽略安全检查方法" class="headerlink" title="解决linux netcore https请求使用自签名证书忽略安全检查方法"></a>解决linux netcore https请求使用自签名证书忽略安全检查方法</h4><p>开始：<br>首先安装openssl和gcc<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openssl-devel gcc</span><br></pre></td></tr></table></figure></p><p>然后是最新版本的curl：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://curl.haxx.se/download/curl-7.59.0.tar.gz</span><br><span class="line">tar -zxf curl-7.59.0.tar.gz</span><br><span class="line">cd curl-7.59.0</span><br><span class="line">./configure --prefix=/usr/local/curl/ --without-nss --with-ssl=/usr/local/ssl/</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p><p>备份原来的curl：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/bin/curl /usr/bin/curl.bak</span><br></pre></td></tr></table></figure></p><p>新安装的curl创建软链接<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/curl/bin/curl /usr/bin/curl</span><br></pre></td></tr></table></figure></p><p>查看此时curl版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --version</span><br></pre></td></tr></table></figure></p><p>编辑搜索目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ld.so.conf</span><br></pre></td></tr></table></figure></p><p>增加一行：<code>/usr/local/curl/lib</code></p><p>重启服务，完成！</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><blockquote><p><a href="https://www.cnblogs.com/esofar/p/8043792.html" target="_blank" rel="noopener">centos部署.net core</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Centos7部署.net core应用&lt;br&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="Centos7" scheme="http://tokyle.com/tags/Centos7/"/>
    
      <category term=".net core" scheme="http://tokyle.com/tags/net-core/"/>
    
  </entry>
  
  <entry>
    <title>使用webpagetest测试不同国家登录响应</title>
    <link href="http://tokyle.com/2018/05/08/%E4%BD%BF%E7%94%A8webpagetest%E6%B5%8B%E8%AF%95%E4%B8%8D%E5%90%8C%E5%9B%BD%E5%AE%B6%E7%99%BB%E5%BD%95%E5%93%8D%E5%BA%94/"/>
    <id>http://tokyle.com/2018/05/08/使用webpagetest测试不同国家登录响应/</id>
    <published>2018-05-08T07:54:34.000Z</published>
    <updated>2018-05-08T07:56:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>使用webpageTest模拟不同国家进行登录操作</p><a id="more"></a><p>产品boss提了个从不同国家测试系统访问响应时间的需求，目前完成的是不同国家登录操作。</p><p>先来个套话：网站的打开速度直接影响用户体验，据悉，网站若没有在4秒内读取出来，大多数的访客就会选择离开，而且网页的载入速度也会影响网站的排名，因此，网站的打开速度极其重要。根据不同的需求去分析网站的加载速度，有助于促进网站高效运行</p><h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p>拿到需求之后，上网搜过很多工具，接触了的有：</p><blockquote><p><a href="https://tools.pingdom.com/" target="_blank" rel="noopener">Pingdom</a><br><a href="https://performance.sucuri.net/" target="_blank" rel="noopener">sucuri</a></p></blockquote><p>以及正在使用的：</p><blockquote><p><a href="http://www.webpagetest.org" target="_blank" rel="noopener">webpagetest</a></p></blockquote><h3 id="webpagetest"><a href="#webpagetest" class="headerlink" title="webpagetest"></a>webpagetest</h3><p>其他的就不介绍了，只介绍怎么使用webpagetest进行不同国家的登录操作。<br>说实话，刚开始接触时候有点懵，webpagetest自己有个<code>Auth</code>模块，原以为可以直接通过这个来进行登录鉴权，结果可以预料，压根没用，后来就开始琢磨<code>Script</code>模块。看了n久官方文档之后，实验出来了，鼓励大家看官方文档啊。。。上链接：</p><blockquote><p><a href="https://sites.google.com/a/webpagetest.org/docs/using-webpagetest/scripting" target="_blank" rel="noopener">script模块</a></p></blockquote><p>webpagetest提供脚本的形式，帮助用户使用脚本来填充表单，达到登录的目的。这点看下来有点类似于自动化测试时候，先看页面源码，找到用户名/密码源码的唯一标识，在script代码框中使用该唯一标识来指代需要用到的元素，例如：登录页面源码展示的用户名：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=&quot;username&quot; class=&quot;ant-input ng-not-empty ng-dirty ng-valid-parse userInput ng-touched&quot; id=&quot;username&quot; type=&quot;text&quot; placeholder=&quot;用户名或邮箱&quot; ng-model=&quot;model.username&quot; ng-change=&quot;onChange()&quot;&gt;</span><br></pre></td></tr></table></figure></p><p>从上面的源码可以看出，使用<code>id</code>可以唯一标志该字段，在自动化测试中使用<code>find_element_by_id(&#39;username&#39;)</code>即可获得该页面元素，类比到webpagetest的script，也是如此：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setValue id=username yourusername</span><br></pre></td></tr></table></figure></p><p>即可完成定位到用户名并且完成用户名输入，同样的，密码：<br>源码为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input id=&quot;password&quot; name=&quot;password&quot; type=&quot;password&quot; class=&quot;ant-input ant-input-lg ng-not-empty ng-dirty ng-valid-parse userInput ng-touched&quot; placeholder=&quot;密码&quot; ng-model=&quot;model.password&quot; autocomplete=&quot;off&quot; focus-if=&quot;model.username&quot; ng-change=&quot;pwdOnChange()&quot;&gt;</span><br></pre></td></tr></table></figure></p><p>webpagetest定位：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setValue id=password yourpassword</span><br></pre></td></tr></table></figure></p><p>当然，点击登录按钮也类似：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clickAndWait innerText=Login</span><br></pre></td></tr></table></figure></p><p>以上演示的只是一种定位方式，更多的使用，还是去看官方文档吧，有各种情况可供选择~~</p><h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>直接上我的登录脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">logData 0</span><br><span class="line">navigate https://test-login.com</span><br><span class="line">logData 1</span><br><span class="line">setValue name=username yourusername</span><br><span class="line">setValue name=password yourpassword</span><br><span class="line">clickAndWait type=submit</span><br></pre></td></tr></table></figure></p><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p><code>logData</code>个人理解是是否开启数据记录的标志，类似开启缓存（可能理解不对），0为关闭，1为开启，对于登录之后的操作，可以在登录前设置<code>logData</code>为1，打开数据记录，这样在后续的操作中就可以使用登录之后的用户信息。</p><h3 id="官方示例"><a href="#官方示例" class="headerlink" title="官方示例"></a>官方示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">// load the account name and password</span><br><span class="line">loadVariablesaccounts.txt</span><br><span class="line"></span><br><span class="line">// bring up the login screen</span><br><span class="line">setEventNamelaunch</span><br><span class="line">navigatehttp://webmail.aol.com</span><br><span class="line"></span><br><span class="line">// ignore any errors from here on (in case the mailbox is empty or we get image challenged)</span><br><span class="line">ignoreErrors1</span><br><span class="line"></span><br><span class="line">// log in</span><br><span class="line">setValuename=loginId%AOLSN%</span><br><span class="line">setValuename=password%AOLPW%</span><br><span class="line">setEventNameload</span><br><span class="line">submitFormname=AOLLoginForm</span><br><span class="line"></span><br><span class="line">// only read and send a mail once an hour</span><br><span class="line">minIntervalAOLMail60</span><br><span class="line"></span><br><span class="line">// close the today curtain</span><br><span class="line">clickclassName=backdrop</span><br><span class="line">sleep5</span><br><span class="line"></span><br><span class="line">// Open the first message with a subject of &quot;test&quot;</span><br><span class="line">setEventNameread</span><br><span class="line">clickAndWaitinnerText=test</span><br><span class="line"></span><br><span class="line">// delete the message</span><br><span class="line">clicktitle=Delete (del)</span><br><span class="line">sleep5</span><br><span class="line"></span><br><span class="line">// open the compose mail form</span><br><span class="line">setEventNamecompose</span><br><span class="line">clickAndWaittitle=Write mail (Alt + w)</span><br><span class="line"></span><br><span class="line">// send a test message to myself</span><br><span class="line">sleep1</span><br><span class="line">setValuetabindex=100%AOLSN%</span><br><span class="line">setValuename=Subjecttest</span><br><span class="line">loadFilemsg.txt%MSG%</span><br><span class="line">setInnerTextcontentEditable=true%MSG%</span><br><span class="line">sleep1</span><br><span class="line">setDOMElementclassName=confirmMessage</span><br><span class="line">setEventNamesend</span><br><span class="line">clickAndWaitinnerText=Send</span><br><span class="line"></span><br><span class="line">endInterval</span><br><span class="line"></span><br><span class="line">// sign off</span><br><span class="line">setEventNamelogout</span><br><span class="line">clickAndWaitclassName=signOutLink</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用webpageTest模拟不同国家进行登录操作&lt;/p&gt;
    
    </summary>
    
      <category term="性能测试" scheme="http://tokyle.com/categories/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="webpagetest" scheme="http://tokyle.com/tags/webpagetest/"/>
    
      <category term="response time" scheme="http://tokyle.com/tags/response-time/"/>
    
  </entry>
  
  <entry>
    <title>Centos7搭建Nitrate</title>
    <link href="http://tokyle.com/2018/04/22/Centos7%E6%90%AD%E5%BB%BANitrate/"/>
    <id>http://tokyle.com/2018/04/22/Centos7搭建Nitrate/</id>
    <published>2018-04-22T10:27:49.000Z</published>
    <updated>2018-04-23T07:56:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>基于python+Django，测试用例管理平台<strong>Nitrate</strong>搭建</p><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>基于目前Jira+confluence已经成为日常流程管控，老大就琢磨着我们测试用例需要个专门的平台进行管控，所以也就产生了调研的需求，候选有俩：testlink和Nitrate，由于目前组内python氛围较活跃，自动化测试用例也是基于python，所以也就是希望能找到一个基于python写的系统，方便定制，二次开发嘛~</p><h2 id="开篇"><a href="#开篇" class="headerlink" title="开篇"></a>开篇</h2><p>在有搭建Nitrate这个任务之后，本着偷懒的心态，首先搜了一圈搭建教程，然而，一篇都没找到！！！也就是说，我得自己折腾了！！！没办法，直接上github找项目地址，说不定在说明里面有介绍呢</p><blockquote><p><a href="https://github.com/Nitrate/Nitrate" target="_blank" rel="noopener">Nitrate项目地址</a></p></blockquote><p>里面的确是有介绍，搭建教程貌似也有，还是各种环境的搭建教程，好像看到些光辉啊..</p><blockquote><p><a href="http://nitrate.readthedocs.io/en/latest/" target="_blank" rel="noopener">Nitrate Doc</a></p></blockquote><p>文档介绍了各种搭建教程，选你看着比较顺眼的，动手吧~</p><h2 id="坎坷的系统搭建"><a href="#坎坷的系统搭建" class="headerlink" title="坎坷的系统搭建"></a>坎坷的系统搭建</h2><p>平时Linux还算是比较顺手，直接选<code>Installing nitrate on RHEL6 with Apache and MySQL</code>，虽然介绍的Redhat的，不都涨一样嘛~开工：<br>由于自己电脑还是Windows的（别提了，测试嘛，需要太多工具，唉），首先就是搭个Centos7的虚拟机，轻车熟路了，非常迅速的完工，Xshell远程连上，开始愉快的黑窗口作业。。</p><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>由于搭建的centos7是所谓的<code>CentOS-7-x86_64-Everything-1611</code>版本，网卡什么的驱动都是装好了，如果你装的是最间版，那么<code>ifconfig</code>命令都敲不了。。。自己百度怎么开网吧。。</p><h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><p>由于是需要从github仓库直接拉项目，所以git就必须先搭个了:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install git</span><br></pre></td></tr></table></figure></p><p>就完成了，如果遇到yum不让用，日志显示XX进程正在使用yum，那要么等，要么就是暴力点，直接杀：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/run/yum.pid</span><br></pre></td></tr></table></figure></p><p>然后就可以安心的yum install了。</p><h4 id="Django"><a href="#Django" class="headerlink" title="Django"></a>Django</h4><p>由于Nitrate是基于Django的，所以，必不可少的需要装个Django；装Django，有三种方法：</p><h5 id="pip"><a href="#pip" class="headerlink" title="pip"></a>pip</h5><p>最简单就是一条命令带走：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install Django</span><br></pre></td></tr></table></figure></p><h5 id="setuptools"><a href="#setuptools" class="headerlink" title="setuptools"></a>setuptools</h5><p>使用setuptools安装，首先需要先装它：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install python-setuptools</span><br></pre></td></tr></table></figure></p><p>安装完成之后，再使用<code>easy_install</code>安装django：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">easy_install django</span><br></pre></td></tr></table></figure></p><h5 id="源码安装"><a href="#源码安装" class="headerlink" title="源码安装"></a>源码安装</h5><p>首先是上官网下载个tar.gz格式的源码包：</p><blockquote><p><a href="https://www.djangoproject.com/download/" target="_blank" rel="noopener">官方源码下载地址</a></p></blockquote><p>然后就可以开始正常的解压安装了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd your_path</span><br><span class="line">rz(windows拷包到linux)</span><br><span class="line">tar -zxvf Django-x.x.tar.gz</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure></p><p>即可完成安装，验证：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin.py</span><br></pre></td></tr></table></figure></p><p>正确安装会出现很多选项，类似这样：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost run]# django-admin.py</span><br><span class="line"></span><br><span class="line">Type &apos;django-admin.py help &lt;subcommand&gt;&apos; for help on a specific subcommand.</span><br><span class="line"></span><br><span class="line">Available subcommands:</span><br><span class="line"></span><br><span class="line">[django]</span><br><span class="line">    check</span><br><span class="line">    compilemessages</span><br><span class="line">    createcachetable</span><br><span class="line">    dbshell</span><br><span class="line">    diffsettings</span><br><span class="line">    dumpdata</span><br></pre></td></tr></table></figure></p><p>好了，这这里来说说遇到的<strong>第一个坑</strong>，鬼知道是为了个什么，Nitrate限制Django版本，当你使用pip或者easy_install安装个2.0版本之后，后面编译安装Nitrate时候，就会开始报错给你了，到时候就知道是多么北京的事了,印象中Django版本要求是<code>1.8&lt;=Django版本&lt;1.11</code> ，唉，所以，如果谁正准备装这个，或者偶尔看到我写的这玩意，真的，记住，还是源码安装Django吧。。。另外，强烈建议你就要你装完系统的python版本（多半是2.7.5），千万别升3.6，不然可能还要哭一会。</p><h4 id="pip-1"><a href="#pip-1" class="headerlink" title="pip"></a>pip</h4><p>上面说的可以使用pip来装Django，但是，貌似2.7.5的python压根就没自带个pip，好吧，反正后面还需要pip，还是先装上吧：<br>首先安装epel扩展<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install epel-release</span><br></pre></td></tr></table></figure></p><p>然后就可以装pip了：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install python-pip</span><br></pre></td></tr></table></figure></p><p>完了清个cache:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br></pre></td></tr></table></figure></p><h4 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h4><p>数据库选MySQL也没什么可纠结了，安装：<br>下载源包：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm</span><br></pre></td></tr></table></figure></p><p>安装mysql源:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum localinstall mysql57-community-release-el7-8.noarch.rpm</span><br></pre></td></tr></table></figure></p><p>检查是否安装成功：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum repolist enabled | grep &quot;mysql.*-community.*&quot;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql-connectors-community/x86_64 MySQL Connectors Community                  51</span><br><span class="line">mysql-tools-community/x86_64      MySQL Tools Community                       63</span><br><span class="line">mysql57-community/x86_64          MySQL 5.7 Community Server                 267</span><br></pre></td></tr></table></figure><p>可以修改源配置，安装你喜欢的版本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/mysql-community.repo</span><br></pre></td></tr></table></figure></p><p>只需要把对应的enable改成1即可。</p><h5 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install mysql-community-server</span><br></pre></td></tr></table></figure><p>这里再次吐槽下公司的网，烂的不是一点半点，这个包印象中有近200M，公司网以20k速度给我下。。。直接流量开热点才下好。</p><h5 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h5><p>systemctl start mysqld</p><h5 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h5><p>systemctl status mysqld</p><h5 id="配置开机启动"><a href="#配置开机启动" class="headerlink" title="配置开机启动"></a>配置开机启动</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable mysqld</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure><h5 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h5><p>查看默认密码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &apos;temporary password&apos; /var/log/mysqld.log</span><br></pre></td></tr></table></figure></p><p>修改密码很简单，<code>mysql -uroot -p</code>进入控制台，改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;pwd&apos;;</span><br></pre></td></tr></table></figure></p><p>顺便改个权限：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;pwd&apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure></p><p>再配个防火墙，3306端口打开，那么在Windows中就能使用工具连接数据库了。</p><h5 id="修改字符编码"><a href="#修改字符编码" class="headerlink" title="修改字符编码"></a>修改字符编码</h5><p>编辑<code>/etc/my.cnf</code>，在[mysqld]下添加配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">character_set_server=utf8</span><br><span class="line">init_connect=&apos;SET NAMES utf8&apos;</span><br></pre></td></tr></table></figure></p><p>重启mysql服务即可。</p><h3 id="开始搭建"><a href="#开始搭建" class="headerlink" title="开始搭建"></a>开始搭建</h3><h4 id="项目clone"><a href="#项目clone" class="headerlink" title="项目clone"></a>项目clone</h4><p>首先是clone到本地：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src</span><br><span class="line">git clone https://github.com/Nitrate/Nitrate.git</span><br></pre></td></tr></table></figure></p><p>大概有这么些东西：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Nitrate]# ll</span><br><span class="line">total 160</span><br><span class="line">-rw-r--r--.  1 root root   609 Apr 22 12:23 AUTHORS</span><br><span class="line">drwxr-xr-x.  4 root root    43 Apr 22 12:41 build</span><br><span class="line">-rw-r--r--.  1 root root 66430 Apr 22 12:23 CHANGELOG.rst</span><br><span class="line">drwxr-xr-x.  4 root root    60 Apr 22 12:23 contrib</span><br><span class="line">drwxr-xr-x.  2 root root    35 Apr 22 12:41 dist</span><br><span class="line">drwxr-xr-x.  3 root root    76 Apr 22 12:23 docs</span><br><span class="line">-rw-r--r--.  1 root root 18092 Apr 22 12:23 LICENSE</span><br><span class="line">-rw-r--r--.  1 root root  1690 Apr 22 12:23 Makefile</span><br><span class="line">-rwxr-xr-x.  1 root root   279 Apr 22 12:23 manage.py</span><br><span class="line">-rw-r--r--.  1 root root   256 Apr 22 12:23 MANIFEST.in</span><br><span class="line">drwxr-xr-x.  2 root root   110 Apr 22 12:41 Nitrate.egg-info</span><br><span class="line">-rw-r--r--.  1 root root 25090 Apr 22 12:23 nitrate.spec</span><br><span class="line">-rw-r--r--.  1 root root  1753 Apr 22 12:23 README.rst</span><br><span class="line">-rw-r--r--.  1 root root  1127 Apr 22 12:23 requirements.txt</span><br><span class="line">-rw-r--r--.  1 root root   657 Apr 22 12:23 setup.cfg</span><br><span class="line">-rw-r--r--.  1 root root  2234 Apr 22 12:23 setup.py</span><br><span class="line">drwxr-xr-x. 19 root root  4096 Apr 22 12:23 tcms</span><br><span class="line">-rw-r--r--.  1 root root   827 Apr 22 12:23 tox.ini</span><br><span class="line">-rw-r--r--.  1 root root     4 Apr 22 12:23 VERSION.txt</span><br></pre></td></tr></table></figure></p><h4 id="安装开发包"><a href="#安装开发包" class="headerlink" title="安装开发包"></a>安装开发包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc python-devel mysql-devel krb5-devel libxml2-devel libxslt-devel</span><br></pre></td></tr></table></figure><p>安装完成之后，还要项目依赖</p><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>进入项目目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/src/Nitrate</span><br></pre></td></tr></table></figure></p><p>开始安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install .</span><br></pre></td></tr></table></figure></p><p>这个过程会在你本地检查一个个的依赖，没有就装，其中就会检查Django，这破版本的问题，真的是害我又重装一遍。安装速度取决于你的网速和电脑硬件性能，安心等着successful。</p><h4 id="源码安装Nitrate"><a href="#源码安装Nitrate" class="headerlink" title="源码安装Nitrate"></a>源码安装Nitrate</h4><p>还是在这个目录，执行:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py install</span><br></pre></td></tr></table></figure></p><p>使用源码安装Nitrate，等着就好，安装完成之后，可以到<code>/usr/lib/python2.7/site-packages</code>下找到你安装的Nitrate：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost site-packages]# ls | grep Nitrate</span><br><span class="line">Nitrate-4.1-py2.7.egg</span><br><span class="line">Nitrate-4.1-py2.7.egg-info</span><br></pre></td></tr></table></figure></p><p>看看里面有啥：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost site-packages]# cd Nitrate-4.1-py2.7.egg</span><br><span class="line">[root@localhost Nitrate-4.1-py2.7.egg]# ls</span><br><span class="line">EGG-INFO  tcms</span><br><span class="line">[root@localhost Nitrate-4.1-py2.7.egg]# ll</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x.  2 root root  130 Apr 22 14:52 EGG-INFO</span><br><span class="line">drwxr-xr-x. 18 root root 4096 Apr 22 14:52 tcms</span><br><span class="line">[root@localhost Nitrate-4.1-py2.7.egg]# cd tcms/</span><br><span class="line">[root@localhost tcms]# ll</span><br><span class="line">total 56</span><br><span class="line">-rw-r--r--.  1 root root  307 Apr 22 14:52 celery.py</span><br><span class="line">-rw-r--r--.  1 root root  586 Apr 22 14:52 celery.pyc</span><br><span class="line">drwxr-xr-x. 11 root root 4096 Apr 22 14:52 core</span><br><span class="line">-rw-r--r--.  1 root root  301 Apr 22 14:52 __init__.py</span><br><span class="line">-rw-r--r--.  1 root root  422 Apr 22 14:52 __init__.pyc</span><br><span class="line">drwxr-xr-x.  4 root root   75 Apr 22 14:52 integration</span><br><span class="line">drwxr-xr-x.  4 root root   32 Apr 22 14:52 locale</span><br><span class="line">drwxr-xr-x.  3 root root  261 Apr 22 14:52 management</span><br><span class="line">drwxr-xr-x.  3 root root  228 Apr 22 14:52 profiles</span><br><span class="line">drwxr-xr-x.  2 root root  272 Apr 22 14:52 report</span><br><span class="line">drwxr-xr-x.  2 root root  241 Apr 22 14:52 search</span><br><span class="line">drwxr-xr-x.  2 root root  224 Apr 22 16:15 settings</span><br><span class="line">drwxr-xr-x.  8 root root   94 Apr 22 15:09 static</span><br><span class="line">drwxr-xr-x. 14 root root 4096 Apr 22 16:06 templates</span><br><span class="line">drwxr-xr-x.  6 root root 4096 Apr 22 14:52 testcases</span><br><span class="line">drwxr-xr-x.  6 root root 4096 Apr 22 14:52 testplans</span><br><span class="line">drwxr-xr-x.  6 root root 4096 Apr 22 14:52 testruns</span><br><span class="line">drwxr-xr-x.  2 root root   86 Apr 22 14:52 tests</span><br><span class="line">-rw-r--r--.  1 root root 2334 Apr 22 14:52 urls.py</span><br><span class="line">-rw-r--r--.  1 root root 2299 Apr 22 14:52 urls.pyc</span><br><span class="line">drwxr-xr-x.  2 root root  123 Apr 22 14:52 utils</span><br><span class="line">-rw-r--r--.  1 root root 1896 Apr 22 14:52 wsgi.py</span><br><span class="line">-rw-r--r--.  1 root root 1605 Apr 22 14:52 wsgi.pyc</span><br><span class="line">drwxr-xr-x.  4 root root 4096 Apr 22 14:52 xmlrpc</span><br></pre></td></tr></table></figure></p><p>记住<code>tcms/</code>这个文件夹，后面的配置，全都在这里面。</p><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="初始化数据"><a href="#初始化数据" class="headerlink" title="初始化数据"></a>初始化数据</h4><p>首先是创建<code>nitrate</code>这数据库，然后创建用户，赋权限，初始化数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create database nitrate;</span><br><span class="line">GRANT ALL PRIVILEGES ON *.* TO &apos;nitrate&apos;@&apos;%&apos; IDENTIFIED BY &apos;pwd&apos; WITH GRANT OPTION;</span><br></pre></td></tr></table></figure></p><h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><p>之前接触过Django的，应该都知道有个文件<code>setting.py</code>这里面是你app的一些重要配置，我们要改的，也就是它。<br>Nitrate把传统意义上的<code>setting.py</code>分成了两个文件（其实是一个文件）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">common.py</span><br><span class="line">project.py</span><br></pre></td></tr></table></figure></p><p>文件路径：<code>/usr/lib/python2.7/site-packages/Nitrate-4.1-py2.7.egg/tcms/settings</code><br>几乎所有配置都可以在<code>common.py</code>中完成，但是<code>project.py</code>在文件开头就是一句话：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from common import *</span><br></pre></td></tr></table></figure></p><p>所以，我们常用的配置，在<code>project.py</code>中完成即可。<br>内容大概长这样，可以参考我的配：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"># Django settings for product env.</span><br><span class="line"></span><br><span class="line">from common import *</span><br><span class="line"></span><br><span class="line"># Debug settings</span><br><span class="line">DEBUG = True</span><br><span class="line">TEMPLATE_DEBUG = DEBUG</span><br><span class="line"></span><br><span class="line"># Database settings</span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;pwd&apos;,</span><br><span class="line">        &apos;HOST&apos;: &apos;192.168.98.133&apos;,</span><br><span class="line">        &apos;PORT&apos;: &apos;3306&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &apos;slave_1&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;pwd&apos;,</span><br><span class="line">        &apos;HOST&apos;: &apos;192.168.98.133&apos;,</span><br><span class="line">        &apos;PORT&apos;: &apos;3306&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># add RemoteUserMiddleWare if kerberos authentication is enabled</span><br><span class="line">MIDDLEWARE_CLASSES += (</span><br><span class="line">#    &apos;django.contrib.auth.middleware.RemoteUserMiddleware&apos;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># Remote kerberos authentication backends</span><br><span class="line">#AUTHENTICATION_BACKENDS = (</span><br><span class="line">#    &apos;tcms.core.contrib.auth.backends.ModAuthKerbBackend&apos;,</span><br><span class="line">#)</span><br><span class="line"></span><br><span class="line">DATABASE_ROUTERS = [&apos;tcms.core.utils.tcms_router.RWRouter&apos;]</span><br><span class="line"></span><br><span class="line"># Kerberos realm</span><br><span class="line">#KRB5_REALM = &apos;EXAMPLE.COM&apos;</span><br><span class="line"></span><br><span class="line"># Bugzilla integration setttings</span><br><span class="line"># Config following settings if your want to integrate with bugzilla</span><br><span class="line">BUGZILLA3_RPC_SERVER = &apos;&apos;</span><br><span class="line">BUGZILLA_URL = &apos;&apos;</span><br><span class="line">BUGZILLA_USER = &apos;&apos;</span><br><span class="line">BUGZILLA_PASSWORD = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># JIRA integration setttings</span><br><span class="line"># Config following settings if your want to integrate with JIRA</span><br><span class="line">JIRA_URL = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># Set the default send mail address</span><br><span class="line">EMAIL_HOST = &apos;smtp.example.com&apos;</span><br><span class="line">EMAIL_FROM = &apos;noreply@example.com&apos;</span><br><span class="line"></span><br><span class="line"># Site-specific messages</span><br><span class="line"></span><br><span class="line"># First run - to detemine need port user or not.</span><br><span class="line">FIRST_RUN = False</span><br><span class="line"></span><br><span class="line"># You can add a help link on the footer of home page as following format:</span><br><span class="line"># (&apos;http://foo.com&apos;, &apos;foo&apos;)</span><br><span class="line">FOOTER_LINKS = (</span><br><span class="line"> (&apos;/xmlrpc/&apos;, &apos;XML-RPC service&apos;),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># added for nitrate3.4 compatibility</span><br><span class="line">DEFAULT_GROUPS = [&apos;default&apos;]</span><br><span class="line">TESTOPIA_XML_VERSION = &apos;1.0&apos;</span><br><span class="line"></span><br><span class="line"># admin settings</span><br><span class="line">ADMINS = (</span><br><span class="line">    # (&apos;Your Name&apos;, &apos;your_email@domain.com&apos;),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># user guide URL</span><br><span class="line">USER_GUIDE_URL = &quot;&quot;</span><br><span class="line"></span><br><span class="line">DEFAULT_PAGE_SIZE = 100</span><br></pre></td></tr></table></figure></p><p>基本需要修改的，一是DEBUG开关，第二个是数据库配置，开启DEBUG开关是为了后面初始化数据时候获取<code>staticfile</code>，开始<strong>第二个坑</strong>：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AUTHENTICATION_BACKENDS</span><br><span class="line">MIDDLEWARE_CLASSES</span><br></pre></td></tr></table></figure></p><p>注释别放开啊别放开，千万别手痒，惨痛的教训，就是手痒在不知道这俩什么含义就放开了，然后在搭建完成之后，登录都登录不了。。一直在报<code>jquery.min.js  404</code>，这个问题真的是折腾死，开始根本想不到是这边的问题，造成把<code>common.py</code>文件研究了个遍，环境重新又搭建两遍，一遍使用<code>venv</code>开启，一遍按原来的来，最终在万念俱灰，把注释又加上才解决，唉。。。</p><h4 id="配置common-py"><a href="#配置common-py" class="headerlink" title="配置common.py"></a>配置common.py</h4><p>首先，直接上我配完的，可参考:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import django.conf.global_settings as DEFAULT_SETTINGS</span><br><span class="line">import os.path</span><br><span class="line"></span><br><span class="line">NITRATE_VERSION = &apos;4.0.0&apos;</span><br><span class="line"></span><br><span class="line">DEBUG = False</span><br><span class="line"></span><br><span class="line"># Administrators error report email settings</span><br><span class="line">ADMINS = (</span><br><span class="line">    # (&apos;Your Name&apos;, &apos;your_email@example.com&apos;),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">TCMS_ROOT_PATH = os.path.abspath(os.path.join(os.path.dirname(__file__), &apos;..&apos;).replace(&apos;\\&apos;, &apos;/&apos;))</span><br><span class="line"></span><br><span class="line">MANAGERS = ADMINS</span><br><span class="line"></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    # Master DB for writing</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;pwd&apos;,</span><br><span class="line">        &apos;HOST&apos;: &apos;192.168.98.133&apos;,</span><br><span class="line">        &apos;PORT&apos;: &apos;3306&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">    # First slave DB for reading</span><br><span class="line">    &apos;slave_1&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.mysql&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;pwd&apos;,</span><br><span class="line">        &apos;HOST&apos;: &apos;192.168.98.133&apos;,</span><br><span class="line">        &apos;PORT&apos;: &apos;3306&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">    # Second slave DB for reporting, optional</span><br><span class="line">    &apos;slave_report&apos;: &#123;</span><br><span class="line">        &apos;ENGINE&apos;: &apos;django.db.backends.3306&apos;,</span><br><span class="line">        &apos;NAME&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;USER&apos;: &apos;nitrate&apos;,</span><br><span class="line">        &apos;PASSWORD&apos;: &apos;pwd&apos;,</span><br><span class="line">        &apos;HOST&apos;: &apos;192.168.98.133&apos;,</span><br><span class="line">        &apos;PORT&apos;: &apos;3306&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Hosts/domain names that are valid for this site; required if DEBUG is False</span><br><span class="line"># See https://docs.djangoproject.com/en/1.5/ref/settings/#allowed-hosts</span><br><span class="line">ALLOWED_HOSTS = [&apos;*&apos;]</span><br><span class="line"></span><br><span class="line"># Local time zone for this installation. Choices can be found here:</span><br><span class="line"># http://en.wikipedia.org/wiki/List_of_tz_zones_by_name</span><br><span class="line"># although not all choices may be available on all operating systems.</span><br><span class="line"># In a Windows environment this must be set to your system time zone.</span><br><span class="line">TIME_ZONE = &apos;UTC&apos;</span><br><span class="line"></span><br><span class="line"># Language code for this installation. All choices can be found here:</span><br><span class="line"># http://www.i18nguy.com/unicode/language-identifiers.html</span><br><span class="line">LANGUAGE_CODE = &apos;en-us&apos;</span><br><span class="line"></span><br><span class="line">SITE_ID = 1</span><br><span class="line"></span><br><span class="line"># If you set this to False, Django will make some optimizations so as not</span><br><span class="line"># to load the internationalization machinery.</span><br><span class="line">USE_I18N = True</span><br><span class="line"></span><br><span class="line"># If you set this to False, Django will not format dates, numbers and</span><br><span class="line"># calendars according to the current locale.</span><br><span class="line">USE_L10N = True</span><br><span class="line"></span><br><span class="line"># If you set this to False, Django will not use timezone-aware datetimes.</span><br><span class="line">USE_TZ = False</span><br><span class="line"></span><br><span class="line"># Absolute filesystem path to the directory that will hold user-uploaded files.</span><br><span class="line"># Example: &quot;/var/www/example.com/media/&quot;</span><br><span class="line">MEDIA_ROOT = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># URL that handles the media served from MEDIA_ROOT. Make sure to use a</span><br><span class="line"># trailing slash.</span><br><span class="line"># Examples: &quot;http://example.com/media/&quot;, &quot;http://media.example.com/&quot;</span><br><span class="line">MEDIA_URL = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># URL prefix for admin absolute URL</span><br><span class="line">ADMIN_PREFIX = &apos;/admin&apos;</span><br><span class="line"></span><br><span class="line">LOGIN_URL = &apos;nitrate-login&apos;</span><br><span class="line">LOGIN_REDIRECT_URL = &apos;user-profile-redirect&apos;</span><br><span class="line">LOGOUT_REDIRECT_URL = &apos;nitrate-login&apos;</span><br><span class="line"></span><br><span class="line"># Absolute path to the directory static files should be collected to.</span><br><span class="line"># Don&apos;t put anything in this directory yourself; store your static files</span><br><span class="line"># in apps&apos; &quot;static/&quot; subdirectories and in STATICFILES_DIRS.</span><br><span class="line"># Example: &quot;/var/www/example.com/static/&quot;</span><br><span class="line">#BASE_DIR = os.path.abspath(os.path.join(os.path.dirname(__file__), &apos;..&apos;).replace(&apos;\\&apos;, &apos;/&apos;))</span><br><span class="line">#STATIC_ROOT = &apos;/usr/lib/python2.7/site-packages/Nitrate-4.1-py2.7.egg/tcms/static/&apos;</span><br><span class="line">STATIC_ROOT = &apos;/home/nitrate/projects/site/assets&apos;</span><br><span class="line">#STATIC_ROOT = os.path.join(TCMS_ROOT_PATH, &apos;static&apos;)</span><br><span class="line"></span><br><span class="line"># URL prefix for static files.</span><br><span class="line"># Example: &quot;http://example.com/static/&quot;, &quot;http://static.example.com/&quot;</span><br><span class="line">STATIC_URL = &apos;/static/&apos;</span><br><span class="line"></span><br><span class="line"># Additional locations of static files</span><br><span class="line">STATICFILES_DIRS = (</span><br><span class="line">    # Put strings here, like &quot;/home/html/static&quot; or &quot;C:/www/django/static&quot;.</span><br><span class="line">    # Always use forward slashes, even on Windows.</span><br><span class="line">    # Don&apos;t forget to use absolute paths, not relative paths.</span><br><span class="line">    os.path.join(TCMS_ROOT_PATH,&apos;static&apos;),</span><br><span class="line">    #&apos;/usr/lib/python2.7/site-packages/Nitrate-4.1-py2.7.egg/tcms/static/&apos;,</span><br><span class="line">#    &apos;/home/nitrate/projects/site/assets&apos;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># List of finder classes that know how to find static files in</span><br><span class="line"># various locations.</span><br><span class="line">STATICFILES_FINDERS = (</span><br><span class="line">    &apos;django.contrib.staticfiles.finders.FileSystemFinder&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles.finders.AppDirectoriesFinder&apos;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"># Make this unique, and don&apos;t share it with anybody.</span><br><span class="line">SECRET_KEY = &apos;^8y!)$0t7yq2+65%&amp;_#@i^_o)eb3^q--y_$e7a_=t$%$1i)zuv&apos;</span><br><span class="line"></span><br><span class="line">TEMPLATES = [</span><br><span class="line">    &#123;</span><br><span class="line">        &apos;BACKEND&apos;: &apos;django.template.backends.django.DjangoTemplates&apos;,</span><br><span class="line">        &apos;DIRS&apos;: [</span><br><span class="line">            os.path.join(TCMS_ROOT_PATH, &apos;templates/&apos;).replace(&apos;\\&apos;, &apos;/&apos;),</span><br><span class="line">        ],</span><br><span class="line">        &apos;APP_DIRS&apos;: True,</span><br><span class="line">        &apos;OPTIONS&apos;: &#123;</span><br><span class="line">            &apos;debug&apos;: True,</span><br><span class="line">            &apos;context_processors&apos;: [</span><br><span class="line">                &apos;django.contrib.auth.context_processors.auth&apos;,</span><br><span class="line">                &apos;django.template.context_processors.debug&apos;,</span><br><span class="line">                &apos;django.template.context_processors.i18n&apos;,</span><br><span class="line">                &apos;django.template.context_processors.media&apos;,</span><br><span class="line">                &apos;django.template.context_processors.static&apos;,</span><br><span class="line">                &apos;django.template.context_processors.tz&apos;,</span><br><span class="line">                &apos;django.contrib.messages.context_processors.messages&apos;,</span><br><span class="line"></span><br><span class="line">                # Added for Nitrate</span><br><span class="line">                &apos;django.template.context_processors.request&apos;,</span><br><span class="line">                &apos;tcms.core.context_processors.admin_prefix_processor&apos;,</span><br><span class="line">                &apos;tcms.core.context_processors.auth_backend_processor&apos;,</span><br><span class="line">                &apos;tcms.core.context_processors.request_contents_processor&apos;,</span><br><span class="line">                &apos;tcms.core.context_processors.settings_processor&apos;,</span><br><span class="line">            ],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MIDDLEWARE_CLASSES = (</span><br><span class="line">    &apos;django.contrib.sessions.middleware.SessionMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.locale.LocaleMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.common.CommonMiddleware&apos;,</span><br><span class="line">    &apos;tcms.core.middleware.CsrfDisableMiddleware&apos;,</span><br><span class="line">    &apos;django.middleware.csrf.CsrfViewMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.auth.middleware.AuthenticationMiddleware&apos;,</span><br><span class="line">    &apos;django.contrib.messages.middleware.MessageMiddleware&apos;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ROOT_URLCONF = &apos;tcms.urls&apos;</span><br><span class="line"></span><br><span class="line"># Python dotted path to the WSGI application used by Django&apos;s runserver.</span><br><span class="line">WSGI_APPLICATION = &apos;tcms.wsgi.application&apos;</span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = (</span><br><span class="line">    &apos;django.contrib.admin&apos;,</span><br><span class="line">    &apos;django.contrib.admindocs&apos;,</span><br><span class="line">    &apos;django.contrib.auth&apos;,</span><br><span class="line">    &apos;django.contrib.contenttypes&apos;,</span><br><span class="line">    &apos;django.contrib.messages&apos;,</span><br><span class="line">    &apos;django.contrib.sessions&apos;,</span><br><span class="line">    &apos;django.contrib.sites&apos;,</span><br><span class="line">    &apos;django.contrib.staticfiles&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;django_comments&apos;,</span><br><span class="line">    &apos;kobo.django.xmlrpc&apos;,</span><br><span class="line">    &apos;tinymce&apos;,</span><br><span class="line"></span><br><span class="line">    &apos;tcms.core.contrib.auth.apps.AppConfig&apos;,</span><br><span class="line">    &apos;tcms.core.contrib.comments.apps.AppConfig&apos;,</span><br><span class="line">    &apos;tcms.core.contrib.linkreference&apos;,</span><br><span class="line">    &apos;tcms.core.logs&apos;,</span><br><span class="line">    &apos;tcms.integration.bugzilla&apos;,</span><br><span class="line">    &apos;tcms.integration.errata&apos;,</span><br><span class="line">    &apos;tcms.management&apos;,</span><br><span class="line">    &apos;tcms.profiles&apos;,</span><br><span class="line">    &apos;tcms.testcases&apos;,</span><br><span class="line">    &apos;tcms.testplans&apos;,</span><br><span class="line">    &apos;tcms.testruns&apos;,</span><br><span class="line">    &apos;tcms.xmlrpc.apps.AppConfig&apos;,</span><br><span class="line"></span><br><span class="line">    # core app must be here in order to use permissions created during creating</span><br><span class="line">    # modules for above apps.</span><br><span class="line">    &apos;tcms.core.apps.AppConfig&apos;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">SESSION_SERIALIZER = &apos;django.contrib.sessions.serializers.JSONSerializer&apos;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Default apps settings</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># Define the custom comment app</span><br><span class="line"># http://docs.djangoproject.com/en/dev/ref/contrib/comments/custom/</span><br><span class="line"></span><br><span class="line">COMMENTS_APP = &apos;tcms.core.contrib.comments&apos;  # &apos;nitrate_comments&apos;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># XML-RPC interface settings</span><br><span class="line">#</span><br><span class="line"># XML-RPC methods</span><br><span class="line"></span><br><span class="line">XMLRPC_METHODS = &#123;</span><br><span class="line">    &apos;TCMS_XML_RPC&apos;: (</span><br><span class="line">        (&apos;tcms.xmlrpc.api.auth&apos;, &apos;Auth&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.build&apos;, &apos;Build&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.env&apos;, &apos;Env&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.product&apos;, &apos;Product&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.testcase&apos;, &apos;TestCase&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.testcaserun&apos;, &apos;TestCaseRun&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.testcaseplan&apos;, &apos;TestCasePlan&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.testopia&apos;, &apos;Testopia&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.testplan&apos;, &apos;TestPlan&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.testrun&apos;, &apos;TestRun&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.user&apos;, &apos;User&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.version&apos;, &apos;Version&apos;),</span><br><span class="line">        (&apos;tcms.xmlrpc.api.tag&apos;, &apos;Tag&apos;),</span><br><span class="line">    ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">XMLRPC_TEMPLATE = &apos;xmlrpc.html&apos;</span><br><span class="line"></span><br><span class="line"># Cache backend</span><br><span class="line">CACHES = &#123;</span><br><span class="line">    &apos;default&apos;: &#123;</span><br><span class="line">        &apos;BACKEND&apos;: &apos;django.core.cache.backends.locmem.LocMemCache&apos;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SESSION_ENGINE = &apos;django.contrib.sessions.backends.cached_db&apos;</span><br><span class="line"></span><br><span class="line"># Needed by django.core.context_processors.debug:</span><br><span class="line"># See http://docs.djangoproject.com/en/dev/ref/templates/api/#django-core-context-processors-debug</span><br><span class="line">INTERNAL_IPS = (&apos;127.0.0.1&apos;, )</span><br><span class="line"></span><br><span class="line"># Authentication backends</span><br><span class="line"># For the login/register/logout reaon, we only support the internal auth backends.</span><br><span class="line">AUTHENTICATION_BACKENDS = (</span><br><span class="line">    &apos;tcms.core.contrib.auth.backends.DBModelBackend&apos;,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Mail settings</span><br><span class="line">#</span><br><span class="line"># Set the default send mail address</span><br><span class="line"># See http://docs.djangoproject.com/en/dev/ref/settings/#email-backend</span><br><span class="line">EMAIL_HOST = &apos;&apos;</span><br><span class="line">EMAIL_PORT = 25</span><br><span class="line">EMAIL_FROM = &apos;noreply@foo.com&apos;</span><br><span class="line">EMAIL_SUBJECT_PREFIX = &apos;[TCMS] &apos;</span><br><span class="line"></span><br><span class="line">EMAILS_FOR_DEBUG = []</span><br><span class="line">ENABLE_ASYNC_EMAIL = True</span><br><span class="line"></span><br><span class="line">CELERY_BROKER_URL = &apos;redis://&apos;</span><br><span class="line"></span><br><span class="line"># Celery worker settings</span><br><span class="line">CELERY_TASK_RESULT_EXPIRES = 60 * 2</span><br><span class="line">CELERY_RESULT_BACKEND = &apos;db+sqlite:///celery-results.db&apos;</span><br><span class="line">CELERYD_TIMER_PRECISION = 120</span><br><span class="line">CELERY_IGNORE_RESULT = True</span><br><span class="line">CELERY_MAX_CACHED_RESULTS = -1</span><br><span class="line">CELERY_DEFAULT_RATE_LIMIT = &apos;250/m&apos;</span><br><span class="line"></span><br><span class="line"># TCMS email behavior settings</span><br><span class="line">PLAN_EMAIL_TEMPLATE = &apos;mail/change_plan.txt&apos;</span><br><span class="line">PLAN_DELELE_EMAIL_TEMPLATE = &apos;mail/delete_plan.txt&apos;</span><br><span class="line">CASE_EMAIL_TEMPLATE = &apos;mail/edit_case.txt&apos;</span><br><span class="line">CASE_DELETE_EMAIL_TEMPLATE = &apos;mail/delete_case.txt&apos;</span><br><span class="line"></span><br><span class="line"># TCMS Bug System settings</span><br><span class="line"># Set default bug system to bugzilla</span><br><span class="line">DEFAULT_BUG_SYSTEM_ID = 1</span><br><span class="line"></span><br><span class="line"># Maximum upload file size, default set to 5MB.</span><br><span class="line"># 2.5MB - 2621440</span><br><span class="line"># 5MB - 5242880</span><br><span class="line"># 10MB - 10485760</span><br><span class="line"># 20MB - 20971520</span><br><span class="line"># 50MB - 5242880</span><br><span class="line"># 100MB 104857600</span><br><span class="line"># 250MB - 214958080</span><br><span class="line"># 500MB - 429916160</span><br><span class="line">MAX_UPLOAD_SIZE = 5242880</span><br><span class="line"></span><br><span class="line"># Pagination</span><br><span class="line">PLAN_RUNS_PAGE_SIZE = 20</span><br><span class="line"></span><br><span class="line"># Site-specific messages</span><br><span class="line"></span><br><span class="line"># The site can supply optional &quot;message of the day&quot; style banners, similar to</span><br><span class="line"># /etc/motd. They are fragments of HTML.</span><br><span class="line"></span><br><span class="line"># This if set, is shown on the login/registration screens.</span><br><span class="line"># MOTD_LOGIN = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># The URLS will be list in footer</span><br><span class="line"># Example:</span><br><span class="line">#FOOTER_LINKS = (</span><br><span class="line">#   (&apos;mailto:nitrate-dev-list@example.com&apos;, &apos;Contact Us&apos;),</span><br><span class="line">#   (&apos;mailto:nitrate-admin@example.com&apos;, &apos;Request Permission&apos;),</span><br><span class="line">#   (&apos;http://foo.com&apos;, &apos;foo&apos;)</span><br><span class="line">#)</span><br><span class="line">FOOTER_LINKS = ()</span><br><span class="line"></span><br><span class="line"># Attachement file download path</span><br><span class="line"># it could be spcified to a different out of MEDIA_URL</span><br><span class="line"># FILE_UPLOAD_DIR = path.join(MEDIA_DIR, &apos;uploads&apos;).replace(&apos;\\&apos;,&apos;/&apos;),</span><br><span class="line">FILE_UPLOAD_DIR = &apos;/var/nitrate/uploads&apos;</span><br><span class="line"></span><br><span class="line"># Enable the administrator delete permission</span><br><span class="line"># In another word it&apos;s set the admin to super user or not.</span><br><span class="line">SET_ADMIN_AS_SUPERUSER = False</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Authentication backend settings</span><br><span class="line">#</span><br><span class="line"># Bugzilla author xmlrpc url</span><br><span class="line"># Required by bugzilla authentication backend</span><br><span class="line">BUGZILLA3_RPC_SERVER = &apos;&apos;</span><br><span class="line">BUGZILLA_URL = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># JIRA URL</span><br><span class="line">JIRA_URL = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># Turn on/off bugzilla external tracker</span><br><span class="line">BUGZILLA_EXTERNAL_TRACKER = False</span><br><span class="line"></span><br><span class="line"># Turn on/off listening signals sent by models.</span><br><span class="line">LISTENING_MODEL_SIGNAL = True</span><br><span class="line"></span><br><span class="line"># Kerberos settings</span><br><span class="line"># Required by kerberos authentication backend</span><br><span class="line">KRB5_REALM = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># Integration with Errata system, used to linkify the Errata ID</span><br><span class="line"># A valid Errata URL:</span><br><span class="line"># https://errata.devel.example.com/errata/stateview/&#123;Errata ID&#125;</span><br><span class="line">ERRATA_URL_PREFIX = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># user guide url:</span><br><span class="line">USER_GUIDE_URL = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># Default page size for showing each possible query result. This provides a</span><br><span class="line"># consistent user experiece to users.</span><br><span class="line">DEFAULT_PAGE_SIZE = 20</span><br><span class="line"></span><br><span class="line"># Disable TCMS to produce test run progress info to consumers by qpid for</span><br><span class="line"># reducing unnecessary I/O access and errata does not subscribe tcms msg now.</span><br><span class="line"># If you want to continue sending msg to qpid, please overwrite it in product</span><br><span class="line"># .py and make sure qpid config is correct.</span><br><span class="line">ENABLE_QPID = False</span><br><span class="line"></span><br><span class="line"># TCMS use Piwik to track request.</span><br><span class="line">ENABLE_PIWIK_TRACKING = False</span><br><span class="line"># Piwik site id, generate by eng-ops</span><br><span class="line">PIWIK_SITE_ID = &apos;&apos;</span><br><span class="line"># Piwik api url without schema.</span><br><span class="line">PIWIK_SITE_API_URL = &apos;&apos;</span><br><span class="line"># Piwik js lib url without schema</span><br><span class="line">PIWIK_SITE_JS_URL = &apos;&apos;</span><br><span class="line"></span><br><span class="line"># A sample logging configuration. The only tangible logging</span><br><span class="line"># performed by this configuration is to send an email to</span><br><span class="line"># the site admins on every HTTP 500 error when DEBUG=False.</span><br><span class="line"># See http://docs.djangoproject.com/en/dev/topics/logging for</span><br><span class="line"># more details on how to customize your logging configuration.</span><br><span class="line">LOGGING = &#123;</span><br><span class="line">    &apos;version&apos;: 1,</span><br><span class="line">    &apos;disable_existing_loggers&apos;: False,</span><br><span class="line">    &apos;formatters&apos;: &#123;</span><br><span class="line">        &apos;verbose&apos;: &#123;</span><br><span class="line">            &apos;format&apos;: &apos;%(levelname)s %(asctime)s %(module)s %(process)d %(thread)d %(message)s&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;simple&apos;: &#123;</span><br><span class="line">            &apos;format&apos;: &apos;[%(asctime)s] %(levelname)s %(message)s&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;xmlrpc_log&apos;: &#123;</span><br><span class="line">            &apos;format&apos;: &apos;[%(asctime)s] %(levelname)s XMLRPC %(process)d &quot;%(message)s&quot;&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &apos;filters&apos;: &#123;</span><br><span class="line">        &apos;require_debug_false&apos;: &#123;</span><br><span class="line">            &apos;()&apos;: &apos;django.utils.log.RequireDebugFalse&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &apos;handlers&apos;: &#123;</span><br><span class="line">        &apos;console&apos;: &#123;</span><br><span class="line">            &apos;level&apos;: &apos;DEBUG&apos;,</span><br><span class="line">            &apos;class&apos;: &apos;logging.StreamHandler&apos;,</span><br><span class="line">            &apos;formatter&apos;: &apos;simple&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;xmlrpc&apos;: &#123;</span><br><span class="line">            &apos;level&apos;: &apos;DEBUG&apos;,</span><br><span class="line">            &apos;class&apos;: &apos;logging.StreamHandler&apos;,</span><br><span class="line">            &apos;formatter&apos;: &apos;xmlrpc_log&apos;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;mail_admins&apos;: &#123;</span><br><span class="line">            &apos;level&apos;: &apos;ERROR&apos;,</span><br><span class="line">            &apos;filters&apos;: [&apos;require_debug_false&apos;],</span><br><span class="line">            &apos;class&apos;: &apos;django.utils.log.AdminEmailHandler&apos;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &apos;loggers&apos;: &#123;</span><br><span class="line">        &apos;django.request&apos;: &#123;</span><br><span class="line">            &apos;handlers&apos;: [&apos;mail_admins&apos;],</span><br><span class="line">            &apos;level&apos;: &apos;ERROR&apos;,</span><br><span class="line">            &apos;propagate&apos;: True,</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;nitrate.xmlrpc&apos;: &#123;</span><br><span class="line">            &apos;handlers&apos;: [&apos;xmlrpc&apos;],</span><br><span class="line">            &apos;level&apos;: &apos;DEBUG&apos;,</span><br><span class="line">            &apos;propagate&apos;: True,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TINYMCE_DEFAULT_CONFIG = &#123;</span><br><span class="line">    &apos;mode&apos;: &quot;exact&quot;,</span><br><span class="line">    &apos;theme&apos;: &quot;advanced&quot;,</span><br><span class="line">    &apos;language&apos;: &quot;en&quot;,</span><br><span class="line">    &apos;skin&apos;: &quot;o2k7&quot;,</span><br><span class="line">    &apos;browsers&apos;: &quot;gecko&quot;,</span><br><span class="line">    &apos;dialog_type&apos;: &quot;modal&quot;,</span><br><span class="line">    &apos;object_resizing&apos;: &apos;true&apos;,</span><br><span class="line">    &apos;cleanup_on_startup&apos;: &apos;true&apos;,</span><br><span class="line">    &apos;forced_root_block&apos;: &quot;p&quot;,</span><br><span class="line">    &apos;remove_trailing_nbsp&apos;: &apos;true&apos;,</span><br><span class="line">    &apos;theme_advanced_toolbar_location&apos;: &quot;top&quot;,</span><br><span class="line">    &apos;theme_advanced_toolbar_align&apos;: &quot;left&quot;,</span><br><span class="line">    &apos;theme_advanced_statusbar_location&apos;: &quot;none&quot;,</span><br><span class="line">    &apos;theme_advanced_buttons1&apos;: &quot;formatselect,&quot;</span><br><span class="line">                               &quot;bold,italic,&quot;</span><br><span class="line">                               &quot;underline,&quot;</span><br><span class="line">                               &quot;bullist,&quot;</span><br><span class="line">                               &quot;numlist,&quot;</span><br><span class="line">                               &quot;link,&quot;</span><br><span class="line">                               &quot;unlink,&quot;</span><br><span class="line">                               &quot;image,&quot;</span><br><span class="line">                               &quot;search,&quot;</span><br><span class="line">                               &quot;|,&quot;</span><br><span class="line">                               &quot;outdent,&quot;</span><br><span class="line">                               &quot;indent,&quot;</span><br><span class="line">                               &quot;hr,&quot;</span><br><span class="line">                               &quot;fullscreen,&quot;</span><br><span class="line">                               &quot;|,&quot;</span><br><span class="line">                               &quot;help&quot;,</span><br><span class="line">    &apos;theme_advanced_buttons2&apos;: &quot;tablecontrols&quot;,</span><br><span class="line">    &apos;theme_advanced_buttons3&apos;: &quot;&quot;,</span><br><span class="line">    &apos;theme_advanced_path&apos;: &apos;false&apos;,</span><br><span class="line">    &apos;theme_advanced_blockformats&apos;: &quot;p,h2,h3,h4,div,code,pre&quot;,</span><br><span class="line">    &apos;theme_advanced_styles&apos;: &quot;[all] clearfix=clearfix;&quot;</span><br><span class="line">                             &quot;[p] summary=summary;&quot;</span><br><span class="line">                             &quot;[div] code=code;&quot;</span><br><span class="line">                             &quot;[img] img_left=img_left;&quot;</span><br><span class="line">                             &quot;[img] img_left_nospacetop=img_left_nospacetop;&quot;</span><br><span class="line">                             &quot;[img] img_right=img_right;&quot;</span><br><span class="line">                             &quot;[img] img_right_nospacetop=img_right_nospacetop;&quot;</span><br><span class="line">                             &quot;[img] img_block=img_block;&quot;</span><br><span class="line">                             &quot;[img] img_block_nospacetop=img_block_nospacetop;&quot;</span><br><span class="line">                             &quot;[div] column span-2=column span-2;&quot;</span><br><span class="line">                             &quot;[div] column span-4=column span-4;&quot;</span><br><span class="line">                             &quot;[div] column span-8=column span-8&quot;,</span><br><span class="line">    &apos;height&apos;: &apos;300&apos;,</span><br><span class="line">    &apos;width&apos;: &apos;100%&apos;,</span><br><span class="line">    &apos;urlconverter_callback&apos;: &apos;myCustomURLConverter&apos;,</span><br><span class="line">    &apos;plugins&apos;: &quot;table,safari,&quot;</span><br><span class="line">               &quot;advimage,&quot;</span><br><span class="line">               &quot;advlink,&quot;</span><br><span class="line">               &quot;fullscreen,&quot;</span><br><span class="line">               &quot;visualchars,&quot;</span><br><span class="line">               &quot;paste,&quot;</span><br><span class="line">               &quot;media,&quot;</span><br><span class="line">               &quot;template,&quot;</span><br><span class="line">               &quot;searchreplace,&quot;</span><br><span class="line">               &quot;emotions,&quot;,</span><br><span class="line">    &apos;table_styles&apos;: &quot;Header 1=header1;&quot;</span><br><span class="line">                    &quot;Header 2=header2;&quot;</span><br><span class="line">                    &quot;Header 3=header3&quot;,</span><br><span class="line">    &apos;table_cell_styles&apos;: &quot;Header 1=header1;&quot;</span><br><span class="line">                         &quot;Header 2=header2;&quot;</span><br><span class="line">                         &quot;Header 3=header3;&quot;</span><br><span class="line">                         &quot;Table Cell=tableCel1&quot;,</span><br><span class="line">    &apos;table_row_styles&apos;: &quot;Header 1=header1;&quot;</span><br><span class="line">                        &quot;Header 2=header2;&quot;</span><br><span class="line">                        &quot;Header 3=header3;&quot;</span><br><span class="line">                        &quot;Table Row=tableRow1&quot;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LOCALE_PATHS = (</span><br><span class="line">    os.path.join(TCMS_ROOT_PATH, &apos;locale&apos;),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">TESTOPIA_XML_VERSION = &apos;1.1&apos;</span><br></pre></td></tr></table></figure></p><p>需要注意的：</p><ol><li>检查<code>INSTALLED_APPS</code>中，是否有<code>django.contrib.staticfiles</code>，很重要！</li><li>DEBUG开关</li><li>数据库配置</li><li><code>STATIC_ROOT</code>,<code>STATIC_URL</code>,<code>STATICFILES_DIRS</code>，这三个，真的真的很重要！并且很容易就出问题，看我注释了那么多行就知道我是试了多少种组合了</li></ol><p>前三条没什么可说的，关键就是第四条，先贴出个<code>第三个坑</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django.core.exceptions.ImproperlyConfigured: The STATICFILES_DIRS setting should not contain the STATIC_ROOT setting</span><br></pre></td></tr></table></figure></p><p>这个是在进行数据初始化时候报的错，问题很好看，字面意思就是，然后我就开始各种尝试配置<code>STATIC_ROOT</code>和<code>STATICFILES_DIRS</code>，首先先解释一下这个配置的作用，首先，配置的是路径，文件夹的路径，作用就是存放静态文件，各种js,css等，在你页面加载的静态文件，都在这个文件夹里。在Django项目进行部署时：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py collectstatic</span><br></pre></td></tr></table></figure></p><p>命令就会把所有需要的静态文件都复制到你配置的<code>STATIC_ROOT</code>文件夹中。所以<code>STATIC_ROOT</code>配置的是你app级的静态文件保存地址。<br>那么<code>STATICFILES_DIRS</code>呢，这个文件夹，可以看成是所有app公共的静态文件的保存地址，当需要加载静态文件时，django会首先在公共的文件中查找，然后去app级的文件夹查找。<br>至于<code>STATIC_URL</code>这个配置其实就是为了映射<code>STATIC_ROOT</code>，值基本配<code>STATIC_URL = &#39;/static/&#39;</code>即可。</p><h3 id="开启服务"><a href="#开启服务" class="headerlink" title="开启服务"></a>开启服务</h3><p>首先是初始化数据：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin.py migrate --settings=tcms.settings.product</span><br></pre></td></tr></table></figure></p><p>将Nitrate一些必须的数据，表初始化；<br>然后是加载静态文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin.py collectstatic --settings=tcms.settings.product</span><br></pre></td></tr></table></figure></p><p>根据你指定的配置，将静态文件拷贝到指定文件夹；<br>然后是创建超级管理员：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin.py createsuperuser --settings=tcms.settings.product</span><br></pre></td></tr></table></figure></p><p>最后，起服务：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">django-admin.py runserver --settings=tcms.settings.product</span><br></pre></td></tr></table></figure></p><p>到浏览器上<code>http://127.0.0.1:8000</code>开始折腾吧~~~</p><h2 id="几个问题"><a href="#几个问题" class="headerlink" title="几个问题"></a>几个问题</h2><h3 id="debug-toolbar"><a href="#debug-toolbar" class="headerlink" title="debug-toolbar"></a>debug-toolbar</h3><p>当打开DEBUG，在进行初始化时，可能会报错：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">no module named debug-toolbar</span><br></pre></td></tr></table></figure></p><p>很明显，缺包，装包，不过包名不叫<code>debug-toolbar</code>,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install django-debug-toolbar</span><br></pre></td></tr></table></figure></p><p>即可。</p><h3 id="django-core-exceptions-ImproperlyConfigured-The-STATICFILES-DIRS-setting-should-not-contain-the-STATIC-ROOT-setting"><a href="#django-core-exceptions-ImproperlyConfigured-The-STATICFILES-DIRS-setting-should-not-contain-the-STATIC-ROOT-setting" class="headerlink" title="django.core.exceptions.ImproperlyConfigured: The STATICFILES_DIRS setting should not contain the STATIC_ROOT setting"></a>django.core.exceptions.ImproperlyConfigured: The STATICFILES_DIRS setting should not contain the STATIC_ROOT setting</h3><p>也是字面意思，STATIC_ROOT配置不能包含在STATICFILES_DIRS中，为什么会遇到这个问题，这玩意是我在第一次起服务没报错，但是页面静态文件一个都获取不到，整个页面朴素的不像话时候，尝试解决引发的另一个问题。先说说页面元素不加载，当初我配置是看网上有介绍<code>STATICFILES_DIRS</code>可以注释，不需要配，然后我就把<code>STATIC_ROOT</code>配成公共文件地址，结果在页面打开Nitrate时候，所有静态文件都是类似于：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;GET /static/media/css/bootstrap/bootstrap.css HTTP/1.1&quot; 404 5904</span><br></pre></td></tr></table></figure></p><p>这样的问题，整个页面就朴素的不行。。。然后又尝试把<code>STATIC_ROOT</code>注释，这次报的是代码中指明了app配置，STATIC_ROOT该项不能少这样的报错；然后两个都保留，这次就出现了上面那个错；再一次，在没看<code>setting.py</code>文件前，把<code>STATIC_ROOT</code>设置成了公共的，<code>STATICFILES_DIRS</code>设置成了app的，一如既往，静态文件全部加载不出来。。最后才修改成上述配置文件样（试过的组合不止这些，反正是折腾死，还怀疑过是copy静态文件时，少拷了个文件，都想改源码了，唉。。。）<br>所以这个问题解决很简单，把<code>STATIC_ROOT</code>设置成了app的，<code>STATICFILES_DIRS</code>设置成了公共的。</p><h3 id="DATABASES-is-improperly-configured-Please-supply-the-ENGINE-value"><a href="#DATABASES-is-improperly-configured-Please-supply-the-ENGINE-value" class="headerlink" title="DATABASES is improperly configured. Please supply the ENGINE value"></a>DATABASES is improperly configured. Please supply the ENGINE value</h3><p>这个报错遇到过好几个，基本是俩原因：</p><ol><li>改配置文件，输错了</li><li>nitrate用户没有权限<br>检查的改了即可。</li></ol><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>周五下午在公司没有搭建成功，搭的都心累了，成果就是一及其朴素的页面；周天早上6点钟开始折腾，一直弄到下午，才完完整整的搭完，唉，真的是个充实的周末…<br>目前环境是搭建在虚拟机中，访问也是只能虚拟机中的Firefox输入<code>http://127.0.0.1:8000</code>才能访问，后面需要结合appach和wsgi，至少是完成公司局域网内访问，这个应该挺简单，再弄。。。</p><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><blockquote><p><a href="https://stackoverflow.com/questions/27213752/collecting-staticfiles-throws-improperlyconfigured/27213753" target="_blank" rel="noopener">Collecting staticfiles throws ImproperlyConfigured</a><br><a href="https://docs.djangoproject.com/en/2.0/howto/static-files/" target="_blank" rel="noopener">Managing static files</a><br><a href="https://www.v2ex.com/t/270503" target="_blank" rel="noopener">Django 使用 Bootstrap，在 DEBUG = True 模式下，部分 js、css 提示 404 错误</a><br><a href="https://www.jianshu.com/p/2e5515032db0" target="_blank" rel="noopener">settings.py中的静态文件管理设置</a><br><a href="http://www.jb51.net/article/128678.htm" target="_blank" rel="noopener">django中的setting最佳配置小结</a></p></blockquote><p>============================================================================================================================================================================================来更新接下来的部署了！</p><hr><p>使用apache&amp;mod_wsgi部署django项目</p><p>使用apache和mod_wsgi来部署Nitrate，使得不需要一直在虚拟机里面的浏览器才能打开Nitrate。</p><h3 id="安装httpd-amp-mod-wsgi"><a href="#安装httpd-amp-mod-wsgi" class="headerlink" title="安装httpd&amp;mod_wsgi"></a>安装httpd&amp;mod_wsgi</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install httpd mod_wsgi</span><br></pre></td></tr></table></figure><h3 id="创建上传文件夹"><a href="#创建上传文件夹" class="headerlink" title="创建上传文件夹"></a>创建上传文件夹</h3><p>创建长传文件夹，并且修改用户及属组：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/nitrate/uploads</span><br><span class="line">chown apache:apache /var/nitrate/uploads</span><br></pre></td></tr></table></figure></p><h3 id="配置mod-wsgi"><a href="#配置mod-wsgi" class="headerlink" title="配置mod_wsgi"></a>配置mod_wsgi</h3><p>在<code>/etc/httpd/conf.d</code>文件夹下，创建文件<code>wsgi.conf</code>，修改内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoadModule wsgi_module modules/mod_wsgi.so</span><br></pre></td></tr></table></figure></p><h3 id="配置Apache-amp-mod-wsgi"><a href="#配置Apache-amp-mod-wsgi" class="headerlink" title="配置Apache&amp;mod_wsgi"></a>配置Apache&amp;mod_wsgi</h3><p>在<code>/etc/httpd/conf.d</code>文件夹下创建nitrate的配置文件<code>nitrate-httpd.conf</code>，具体内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"># Deployment using mod_wsgi</span><br><span class="line">#</span><br><span class="line"># Useful documentation:</span><br><span class="line"># https://docs.djangoproject.com/en/1.5/howto/deployment/wsgi/</span><br><span class="line"></span><br><span class="line"># Force the use of ssl:</span><br><span class="line">#&lt;IfModule mod_rewrite.c&gt;</span><br><span class="line">#    RewriteEngine on</span><br><span class="line">#    RewriteCond %&#123;HTTPS&#125; off</span><br><span class="line">#    RewriteRule ^(.*)$ https://%&#123;HTTP_HOST&#125;%&#123;REQUEST_URI&#125;</span><br><span class="line">#&lt;/IfModule&gt;</span><br><span class="line"></span><br><span class="line"># Make sure static files collected to this dir</span><br><span class="line"># Ref https://docs.djangoproject.com/en/1.5/ref/contrib/staticfiles/#django-admin-collectstatic</span><br><span class="line">#Alias /static /usr/share/nitrate/statici</span><br><span class="line">Alias /static /home/nitrate/projects/site/assets</span><br><span class="line">#Alias /usr/lib/python2.7/site-packages/Nitrate-4.1-py2.7.egg/tcms/static</span><br><span class="line"></span><br><span class="line"># Limit threads forked:</span><br><span class="line"># prefork MPM </span><br><span class="line">StartServers 5</span><br><span class="line">MinSpareServers 5</span><br><span class="line">MaxSpareServers 10</span><br><span class="line">MaxClients 256</span><br><span class="line">MaxRequestsPerChild 0</span><br><span class="line"></span><br><span class="line"># Configurations for mod_wsgi</span><br><span class="line">WSGIScriptAlias / /usr/lib/python2.7/site-packages/tcms/wsgi.py</span><br><span class="line">WSGIPythonPath /usr/lib/python2.7/site-packages</span><br><span class="line">WSGIPassAuthorization On</span><br><span class="line"></span><br><span class="line">&lt;Location &quot;/&quot;&gt;</span><br><span class="line">    # ====================</span><br><span class="line">    # Handler for mod_wsgi</span><br><span class="line">    # ====================</span><br><span class="line">    SetHandler wsgi-script</span><br><span class="line"></span><br><span class="line">    Options All</span><br><span class="line">    AllowOverride All</span><br><span class="line">    Require all granted</span><br><span class="line">    LimitRequestBody 10485760</span><br><span class="line">    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/javascript application/x-javascript text/css</span><br><span class="line"></span><br><span class="line">    ErrorDocument 401 &quot;Your request is unauthorization.&quot;</span><br><span class="line">&lt;/Location&gt;</span><br><span class="line"></span><br><span class="line">&lt;Location &quot;/static&quot;&gt;</span><br><span class="line">    SetHandler None</span><br><span class="line"></span><br><span class="line">    # Disable auth on the static content, so that we&apos;re aren&apos;t forced to</span><br><span class="line">    # use Kerberos.  Doing so would remove &quot;Expires&quot; headers from the static</span><br><span class="line">    # content, which would lead to poor page-load times.</span><br><span class="line">    AuthType none</span><br><span class="line">    Satisfy Any</span><br><span class="line">    Allow from All</span><br><span class="line"></span><br><span class="line">    # Many file types are likely to benefit from compression</span><br><span class="line">    # Enable gzip compression on them:</span><br><span class="line">    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/javascript application/x-javascript text/css</span><br><span class="line"></span><br><span class="line">    # Set far-future Expires headers on static content</span><br><span class="line">    # (trac 184):</span><br><span class="line">    ExpiresActive On</span><br><span class="line">    ExpiresDefault &quot;access plus 10 years&quot;</span><br><span class="line">&lt;/Location&gt;</span><br></pre></td></tr></table></figure></p><p>需要注意的几个配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Alias /static /home/nitrate/projects/site/assets</span><br><span class="line">WSGIScriptAlias / /usr/lib/python2.7/site-packages/tcms/wsgi.py</span><br><span class="line">WSGIPythonPath /usr/lib/python2.7/site-packages</span><br></pre></td></tr></table></figure></p><p>都修改成你自己的本地路径</p><h3 id="httpd-conf"><a href="#httpd-conf" class="headerlink" title="httpd.conf"></a>httpd.conf</h3><p>说实话，我对这玩意是真的不熟悉，就基本没改，路径：<code>/etc/httpd/conf/httpd.conf</code>，只需要修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ServerName example.com:80</span><br><span class="line">Listen ip_address:80</span><br></pre></td></tr></table></figure></p><p>我比较懒，直接一个改成<code>localhost</code>，另一个改为<code>80</code>，就完工了。<br>然后就可以起服务了！！！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start httpd.service</span><br></pre></td></tr></table></figure></p><p>在本地windows下的浏览器应该就可以直接访问虚拟机的ip来访问nitrate了</p><h3 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h3><p>反正对我来说不是可能，全遇到了。。</p><h4 id="httpd服务启动失败"><a href="#httpd服务启动失败" class="headerlink" title="httpd服务启动失败"></a>httpd服务启动失败</h4><p>这个问题，原因很多，直接看日志比较正常，我是因为端口配错了才出现</p><h4 id="页面报错，无法连接mysql，报权限问题"><a href="#页面报错，无法连接mysql，报权限问题" class="headerlink" title="页面报错，无法连接mysql，报权限问题"></a>页面报错，无法连接mysql，报权限问题</h4><p>首先，检查是否有权限，在确定有权限情况下，基本是系统的问题了。<br>解释一下，虚拟机装的是centos，centos在默认情况下SELinux是打开的，这玩意，是不允许远程连接MySQL资源的。。。所以简单的解决：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0</span><br></pre></td></tr></table></figure></p><p>网上有个建议做法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setsebool httpd_can_network_connect_db 1</span><br></pre></td></tr></table></figure></p><p>允许Apache访问外部MySQL资源</p><h4 id="浏览器访问虚拟机IP，静态文件不加载"><a href="#浏览器访问虚拟机IP，静态文件不加载" class="headerlink" title="浏览器访问虚拟机IP，静态文件不加载"></a>浏览器访问虚拟机IP，静态文件不加载</h4><p>和之前碰到的配路径一样，所有静态文件加载都是403，加载不了，这次，确定不是路径配置的问题，那就是权限问题呗，给你<code>/static</code>目录下的文件赋权限，有可执行权限即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 755 /static</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;基于python+Django，测试用例管理平台&lt;strong&gt;Nitrate&lt;/strong&gt;搭建&lt;/p&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="Centos7" scheme="http://tokyle.com/tags/Centos7/"/>
    
      <category term="Nitrate" scheme="http://tokyle.com/tags/Nitrate/"/>
    
  </entry>
  
  <entry>
    <title>Centos下升级python2.7到3.6</title>
    <link href="http://tokyle.com/2018/04/20/Centos%E4%B8%8B%E5%8D%87%E7%BA%A7python2-7%E5%88%B03-6/"/>
    <id>http://tokyle.com/2018/04/20/Centos下升级python2-7到3-6/</id>
    <published>2018-04-20T03:35:53.000Z</published>
    <updated>2018-04-20T03:37:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>Centos下，修改python版本，保留原2.7.5版本同时，更改默认版本为3.6</p><a id="more"></a><h3 id="保留原版本"><a href="#保留原版本" class="headerlink" title="保留原版本"></a>保留原版本</h3><p>由于yum中会配置python版本，在进行python版本更新时，需要先将yum的配置文件都更改了。<br>首先，切用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - root</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/bin/python2.7 /usr/bin/python2.7.5　　# 保留默认版本python为python2.7.5</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/bin/python2.7.5 /usr/local/bin/python2.7.5　　# 创建软连接</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al /usr/bin/yum*　　# 查看/usr/bin/目录下所有yum文件，共7个</span><br></pre></td></tr></table></figure><p>一个一个改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python —&gt; #!/usr/bin/python2.7.5</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/libexec/urlgrabber-ext-down　　# 修改/usr/libexec/目录下 urlgrabber-ext-down</span><br><span class="line">#!/usr/bin/python —&gt; #!/usr/bin/python2.7.5</span><br></pre></td></tr></table></figure><h3 id="安装python3-6"><a href="#安装python3-6" class="headerlink" title="安装python3.6"></a>安装python3.6</h3><h4 id="安装配置环境"><a href="#安装配置环境" class="headerlink" title="安装配置环境"></a>安装配置环境</h4><h5 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h5><p>首先检查是否有安装wget，没有则需要安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install wget</span><br></pre></td></tr></table></figure></p><h4 id="准备编译环境"><a href="#准备编译环境" class="headerlink" title="准备编译环境"></a>准备编译环境</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum groupinstall &apos;Development Tools&apos;</span><br><span class="line">yum install zlib-devel bzip2-devel openssl-devel ncurses-devel</span><br></pre></td></tr></table></figure><h4 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz</span><br><span class="line">tar zxvf Python-3.6.2.tgz</span><br><span class="line">cd Python-3.6.2</span><br><span class="line">./configure</span><br><span class="line">make all</span><br><span class="line">make install</span><br><span class="line">make clean</span><br><span class="line">make distclean</span><br><span class="line">rm -rf /usr/bin/python</span><br><span class="line">rm -rf /usr/bin/python3</span><br><span class="line">rm -rf /usr/bin/python3.6</span><br><span class="line">ln -s /usr/local/bin/python3.6 /usr/bin/python</span><br><span class="line">ln -s /usr/local/bin/python3.6 /usr/bin/python3</span><br><span class="line">ln -s /usr/local/bin/python3.6 /usr/bin/python3.6</span><br><span class="line">/usr/bin/python -V</span><br><span class="line">/usr/bin/python3 -V</span><br><span class="line">/usr/bin/python3.6 -V</span><br><span class="line">rm -rf /usr/local/bin/python</span><br><span class="line">rm -rf /usr/local/bin/python3</span><br><span class="line">ln -s /usr/local/bin/python3.6 /usr/local/bin/python</span><br><span class="line">ln -s /usr/local/bin/python3.6 /usr/local/bin/python3</span><br><span class="line">python -V</span><br><span class="line">python3 -V</span><br><span class="line">python3.6 -V</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost Python-3.6.2]# python -V</span><br><span class="line">Python 3.6.2</span><br><span class="line">[root@localhost Python-3.6.2]# python3 -V</span><br><span class="line">Python 3.6.2</span><br><span class="line">[root@localhost Python-3.6.2]# python3.6 -V</span><br><span class="line">Python 3.6.2</span><br></pre></td></tr></table></figure><p>安装成功~</p><blockquote><p><a href="https://blog.csdn.net/hu19921016/article/details/72236966" target="_blank" rel="noopener">参考链接</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Centos下，修改python版本，保留原2.7.5版本同时，更改默认版本为3.6&lt;/p&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="python" scheme="http://tokyle.com/tags/python/"/>
    
      <category term="Centos7" scheme="http://tokyle.com/tags/Centos7/"/>
    
  </entry>
  
  <entry>
    <title>切换163yum源</title>
    <link href="http://tokyle.com/2018/04/19/%E5%88%87%E6%8D%A2163yum%E6%BA%90/"/>
    <id>http://tokyle.com/2018/04/19/切换163yum源/</id>
    <published>2018-04-19T08:53:10.000Z</published>
    <updated>2018-04-19T08:54:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>来篇福利文</p><a id="more"></a><p>经常装环境的应该遇过下包基本没动静，基于这“伟大”的互联网环境，下包真的是很心累的一件事，好在国内有志之士还是弄了很多福利的，下面：<code>Centos切换国内163yum源</code></p><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>前提条件，linux服务器支持<code>wget</code>，没有则装一个：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y wget</span><br></pre></td></tr></table></figure></p><p>装好之后，开始切换yum源。</p><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><p>首先，搭环境的必要素质，修改配置文件之前，一定要先备份！（踩了n多坑的教训）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span><br></pre></td></tr></table></figure></p><h4 id="下载163源"><a href="#下载163源" class="headerlink" title="下载163源"></a>下载163源</h4><p>切换到<code>/etc/yum.repos.d</code>，wget下载163源配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.163.com/.help/CentOS6-Base-163.repo</span><br></pre></td></tr></table></figure></p><h4 id="改名"><a href="#改名" class="headerlink" title="改名"></a>改名</h4><p>修改下载完成的文件的名称<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/yum.repos.d/CentOS6-Base-163.repo /etc/yum.repos.d/CentOS-Base.rep</span><br></pre></td></tr></table></figure></p><h4 id="生成缓存"><a href="#生成缓存" class="headerlink" title="生成缓存"></a>生成缓存</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure><p>完工~~~</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;来篇福利文&lt;/p&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="linux" scheme="http://tokyle.com/tags/linux/"/>
    
      <category term="yum" scheme="http://tokyle.com/tags/yum/"/>
    
  </entry>
  
  <entry>
    <title>MySQL之SQL优化系列（三）</title>
    <link href="http://tokyle.com/2018/04/18/MySQL%E4%B9%8BSQL%E4%BC%98%E5%8C%96%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <id>http://tokyle.com/2018/04/18/MySQL之SQL优化系列（三）/</id>
    <published>2018-04-18T08:55:17.000Z</published>
    <updated>2018-04-18T08:56:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>MySQL精准分析执行时间</p><a id="more"></a><p>当进行sql性能瓶颈分析时，第一反应肯定是查看sql执行时间，那么当使用慢查询日志，以及explain都无法知晓具体信息时，怎么分析。</p><h3 id="Query-Profiler"><a href="#Query-Profiler" class="headerlink" title="Query Profiler"></a>Query Profiler</h3><p>Query Profiler是MYSQL自带的一种query诊断分析工具，通过它可以分析出一条SQL语句的性能瓶颈在什么地方。通过<code>show variables like &quot;%pro%&quot;;</code>可以查看该工具是否开启：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &quot;%pro%&quot;;</span><br><span class="line">+------------------------------------------+-------+</span><br><span class="line">| Variable_name                            | Value |</span><br><span class="line">+------------------------------------------+-------+</span><br><span class="line">| check_proxy_users                        | OFF   |</span><br><span class="line">| have_profiling                           | YES   |</span><br><span class="line">| mysql_native_password_proxy_users        | OFF   |</span><br><span class="line">| performance_schema_max_program_instances | -1    |</span><br><span class="line">| profiling                                | OFF   |</span><br><span class="line">| profiling_history_size                   | 15    |</span><br><span class="line">| protocol_version                         | 10    |</span><br><span class="line">| proxy_user                               |       |</span><br><span class="line">| sha256_password_proxy_users              | OFF   |</span><br><span class="line">| slave_compressed_protocol                | OFF   |</span><br><span class="line">| stored_program_cache                     | 256   |</span><br><span class="line">+------------------------------------------+-------+</span><br><span class="line">11 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>发现当前为关闭状态，手动开启：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set profiling = 1;</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>首先执行几条sql，作为分析样本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sleep(3);</span><br><span class="line">+----------+</span><br><span class="line">| sleep(3) |</span><br><span class="line">+----------+</span><br><span class="line">|        0 |</span><br><span class="line">+----------+</span><br><span class="line">1 row in set (3.00 sec)</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 1;</span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">| 1 |</span><br><span class="line">+---+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>查看执行情况：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profiles;</span><br><span class="line">+----------+------------+-----------------------------+</span><br><span class="line">| Query_ID | Duration   | Query                       |</span><br><span class="line">+----------+------------+-----------------------------+</span><br><span class="line">|        1 | 0.00325925 | show variables like &quot;%pro%&quot; |</span><br><span class="line">|        2 | 2.99971075 | select sleep(3)             |</span><br><span class="line">|        3 | 0.00051050 | select 1                    |</span><br><span class="line">+----------+------------+-----------------------------+</span><br><span class="line">3 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>可以看出具体执行时间，若想查看具体那一条SQL的具体信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile for query 2;      </span><br><span class="line">+----------------------+----------+   </span><br><span class="line">| Status               | Duration |   </span><br><span class="line">+----------------------+----------+   </span><br><span class="line">| starting             | 0.000103 |   </span><br><span class="line">| checking permissions | 0.000008 |   </span><br><span class="line">| Opening tables       | 0.000006 |   </span><br><span class="line">| init                 | 0.000016 |   </span><br><span class="line">| optimizing           | 0.000008 |   </span><br><span class="line">| executing            | 0.000018 |   </span><br><span class="line">| User sleep           | 2.999385 |   </span><br><span class="line">| end                  | 0.000016 |   </span><br><span class="line">| query end            | 0.000009 |   </span><br><span class="line">| closing tables       | 0.000005 |   </span><br><span class="line">| freeing items        | 0.000115 |   </span><br><span class="line">| cleaning up          | 0.000023 |   </span><br><span class="line">+----------------------+----------+   </span><br><span class="line">12 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><h4 id="对系统分析"><a href="#对系统分析" class="headerlink" title="对系统分析"></a>对系统分析</h4><p>查看执行sql中对系统的影响，例如，查看磁盘IO：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile block io for query 2;</span><br><span class="line">+----------------------+----------+--------------+---------------+</span><br><span class="line">| Status               | Duration | Block_ops_in | Block_ops_out |</span><br><span class="line">+----------------------+----------+--------------+---------------+</span><br><span class="line">| starting             | 0.000103 |         NULL |          NULL |</span><br><span class="line">| checking permissions | 0.000008 |         NULL |          NULL |</span><br><span class="line">| Opening tables       | 0.000006 |         NULL |          NULL |</span><br><span class="line">| init                 | 0.000016 |         NULL |          NULL |</span><br><span class="line">| optimizing           | 0.000008 |         NULL |          NULL |</span><br><span class="line">| executing            | 0.000018 |         NULL |          NULL |</span><br><span class="line">| User sleep           | 2.999385 |         NULL |          NULL |</span><br><span class="line">| end                  | 0.000016 |         NULL |          NULL |</span><br><span class="line">| query end            | 0.000009 |         NULL |          NULL |</span><br><span class="line">| closing tables       | 0.000005 |         NULL |          NULL |</span><br><span class="line">| freeing items        | 0.000115 |         NULL |          NULL |</span><br><span class="line">| cleaning up          | 0.000023 |         NULL |          NULL |</span><br><span class="line">+----------------------+----------+--------------+---------------+</span><br><span class="line">12 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>可以完整的看出<code>select sleep(3);</code>该sql执行过程中对磁盘IO的影响。类似的还有：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show profile cpu for query 2;</span><br><span class="line">mysql&gt; show profile memory for query 2;</span><br><span class="line">mysql&gt; show profile swaps for query 2;</span><br><span class="line">mysql&gt; show profile context switches for query 2;</span><br><span class="line">mysql&gt; show profile all for query 2;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;MySQL精准分析执行时间&lt;/p&gt;
    
    </summary>
    
      <category term="MySQL-SQL优化" scheme="http://tokyle.com/categories/MySQL-SQL%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="profiler" scheme="http://tokyle.com/tags/profiler/"/>
    
  </entry>
  
  <entry>
    <title>loadruner日常总结</title>
    <link href="http://tokyle.com/2018/04/18/loadruner%E6%97%A5%E5%B8%B8%E6%80%BB%E7%BB%93/"/>
    <id>http://tokyle.com/2018/04/18/loadruner日常总结/</id>
    <published>2018-04-18T01:39:54.000Z</published>
    <updated>2018-04-18T01:45:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>日常工作中遇到的loadrunner的相关问题的总结：</p><a id="more"></a><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>首先，使用的环境（版本）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">WIN7 企业版 Service Pack1</span><br><span class="line">loadrunner 12.50</span><br><span class="line">IE 11</span><br></pre></td></tr></table></figure></p><h4 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h4><p>本来用习惯了，到了新公司第一件事就是装了<code>WIN10</code>，loadrunner版本使用的也是<code>loadrunner 12.50</code>，然后，开始工作，录制脚本时候，开始了各种神坑问题，对了，先说一句，笔记本是<code>Thinkpad T430</code>（不是win 10系统的锅）。录制时候就开始了坑死人的经历，第一个是基本相当于不支持<code>chrome</code>，想用chrome录制，必须开代理或者<code>fiddle</code>，简直是愁；换成firefox，浏览器都打不开，用IE，各种的需要安全证书，或者就是压根浏览器直接未响应。<br>好不容易开着代理，用chrome录制好了，回放，70%的概率电脑会蓝屏，无语至极。</p><h4 id="艰难的环境搭建"><a href="#艰难的环境搭建" class="headerlink" title="艰难的环境搭建"></a>艰难的环境搭建</h4><p>没办法，日常工作现在就是在性能测试上，只好放弃win10，转用win7了（再次再次提醒，T430千万别用win10来搭配loadrunner！！！）<br>再次重装系统，这次用了什么鬼纯净版，也就是<code>ghost版</code>，是人为在官方原本基础上的优化版，唉，装是装好了，事又来了，众所周知，loadrunner和浏览器的兼容实在是个很深的坑尤其是64位的windows系统，更是能选用的很少。试了各种chrome，firefox，ie甚至什么遨游，世界之窗，基本是快奔溃的状态。实验半天，基本兼容性是:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IE &gt; firefox &gt; chrome</span><br></pre></td></tr></table></figure></p><p>IE最好，firefox网上基本是建议用25左右的版本，但是，没有64位的啊。。。chrome就别提了，老样子，要么是要开代理，要么是直接打开浏览器就未响应。所以，首选还是IE啊，但是，试了下，公司的测试网站，在IE8上压根就打不开（win7自带是IE8），版本太低了！必须要升级到IE11，升级是简单，找到<code>windows update</code>搜索下载，下载完更新即可，安装完成需要重启系统，然后坑来了：<strong>ghost版装的系统，直接帮你“优化了”权限，基本你是默认就是管理员，然后在安装windows更新时候，问题就来了，系统会在判断你权限时候，发现权限混乱，直接更新失败，返回还原点，windows——update failure，error code：80070005</strong>，唉，简直是半疯。在实验了其他n中手动更新IE的方法失败之后，只能放弃。<br>直接上<a href="https://msdn.itellyou.cn/" target="_blank" rel="noopener">MSDN</a>下载官方镜像，重新安装系统，这次终于是成功将IE8更新到IE11了。</p><h3 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h3><h4 id="CV证书"><a href="#CV证书" class="headerlink" title="CV证书"></a>CV证书</h4><p>在录制时候，经常会遇到不适用loadrunner录制，网页可以打开，使用loadrunner录制，网页打开显示“无法此页”；可能在浏览器显示该页面之前，已经弹出了一个类似<code>该网站CV证书。。。</code>的弹窗提示，意思很明显，该测试网站，在你的浏览器安全证书中没有它的证书，所以浏览器的安全策略就过滤了该浏览器的连接，页面就打不开了。</p><h5 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h5><p>在录制时候：<br>点击Recoding Oftions，在Network栏，点击Mapping and Filtering，Port mapping选择WinINet level data，点击确定，录制即可。</p><h4 id="loadrunner未响应"><a href="#loadrunner未响应" class="headerlink" title="loadrunner未响应"></a>loadrunner未响应</h4><p>该问题，网上有很多解答，基本第一条就是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IE - Internet选项 - 高级 - 启用第三方软件扩展（取消勾选）</span><br></pre></td></tr></table></figure></p><p>然后，我是直接用管理员登录的系统，再进行录制就可以了。附上网上有个很全的回答：<br><a href="http://www.cnblogs.com/boheyixia/p/3758508.html" target="_blank" rel="noopener">loadrunner点击录制不响应</a></p><h4 id="请求接口HTTP-CODE-500"><a href="#请求接口HTTP-CODE-500" class="headerlink" title="请求接口HTTP CODE 500"></a>请求接口HTTP CODE 500</h4><p>在排除接口异常，使用其他如postman，soupui等工具直接请求可以成功返回数据情况下，查看使用loadrunner录制的脚本，是否在传参的时候将参数进行格式化，以<code>JSON</code>格式传参，我是遇到过很多次，直接使用loadrunner录制脚本，录制出来的脚本中缺少格式化:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;EncType=application/json; charset=utf-8&quot;,</span><br></pre></td></tr></table></figure></p><p>录制出来的脚本类似：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">web_custom_request(&quot;2018_1&quot;, </span><br><span class="line">&quot;URL=https://www.test.com/api/config/calendar/1/2018&quot;, </span><br><span class="line">&quot;Method=PUT&quot;, </span><br><span class="line">&quot;Resource=0&quot;, </span><br><span class="line">&quot;RecContentType=application/json&quot;, </span><br><span class="line">&quot;Referer=https://www.test.com/app&quot;, </span><br><span class="line">&quot;Snapshot=t16.inf&quot;,</span><br><span class="line">&quot;Mode=HTML&quot;, </span><br><span class="line">&quot;Body=&#123;\&quot;2018-11-01\&quot;:1&#125;&quot;, </span><br><span class="line">LAST);</span><br></pre></td></tr></table></figure></p><p>这样请求，即使加上所有token，很可能还是会500，所以手工加上一句格式化json的即可。</p><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>loadrunner作为付费软件，限制其实还是挺多的，日常生活中遇到什么问题，还需要继续记录。<br>P.S 做性能测试，真的是，能用Jmeter或者locust，真的，就转吧。。。破解个限制这么多的，实在是，唉。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;日常工作中遇到的loadrunner的相关问题的总结：&lt;/p&gt;
    
    </summary>
    
      <category term="性能测试" scheme="http://tokyle.com/categories/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="loadrunner" scheme="http://tokyle.com/tags/loadrunner/"/>
    
  </entry>
  
  <entry>
    <title>CentOs7强制修改MySQL中root密码</title>
    <link href="http://tokyle.com/2018/04/04/CentOs7%E5%BC%BA%E5%88%B6%E4%BF%AE%E6%94%B9MySQL%E4%B8%ADroot%E5%AF%86%E7%A0%81/"/>
    <id>http://tokyle.com/2018/04/04/CentOs7强制修改MySQL中root密码/</id>
    <published>2018-04-04T07:57:21.000Z</published>
    <updated>2018-04-04T07:59:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>centos7强制修改MySQL默认密码</p><a id="more"></a><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近需要搭建zabbix，需要在centos7上搭建MySQL服务器；这个很简单，直接命令：<br>获取MySQL源：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rpm -Uvh https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span><br></pre></td></tr></table></figure></p><p>安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install mysql-* --skip-broken</span><br></pre></td></tr></table></figure></p><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>安装过程，由于公司网简直惨不忍睹，中间一度断掉了，都不知道哪边安装出错了。。。好不容易看着安装成功之后，查找默认的root密码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep &apos;temporary password&apos; /var/log/mysqld.log</span><br></pre></td></tr></table></figure></p><p>然后就悲剧了，这个日志文件，压根就是空的，root密码跑哪玩去了！！！<br>然后试了试，貌似好像可以起服务。。见鬼<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mysqld</span><br><span class="line">systemctl status mysqld</span><br></pre></td></tr></table></figure></p><p>不过这样还是进不了控制台啊，没密码啊，没办法，只有强制修改root密码。</p><h3 id="强制修改密码"><a href="#强制修改密码" class="headerlink" title="强制修改密码"></a>强制修改密码</h3><p>首先强制修改配置文件，<code>/etc/my.cnf</code><br>添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables=1</span><br></pre></td></tr></table></figure></p><p>添加<code>skip-grant-tables=1</code>这行，然后重启MySQL服务。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart mysqld</span><br></pre></td></tr></table></figure></p><h4 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h4><p>进入MySQL控制台：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql</span><br></pre></td></tr></table></figure></p><p>打印：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.21 MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></p><h4 id="修改密码-1"><a href="#修改密码-1" class="headerlink" title="修改密码"></a>修改密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">update user set authentication_string = password(&quot;xxxx&quot;) where user=&quot;root&quot;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>然后将<code>/etc/my.cnf</code>下<code>skip-grant-tables=1</code>注释掉，重启MySQL服务。</p><h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><p>使用修改完成的root密码登录MySQL控制台之后，可以进入控制台：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 2</span><br><span class="line">Server version: 5.7.21</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br></pre></td></tr></table></figure></p><p>但是有问题：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show databases;</span><br><span class="line">ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</span><br></pre></td></tr></table></figure></p><p>按照提示，我们在修改root密码时候，应该使用的是alter而不是update来更新密码，所以，重新修改密码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter user &apos;root&apos;@&apos;localhost&apos; identified by &apos;QWEqwe+342&apos;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure></p><p>再次重启服务即可。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;centos7强制修改MySQL默认密码&lt;/p&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="mysql" scheme="http://tokyle.com/tags/mysql/"/>
    
      <category term="linux" scheme="http://tokyle.com/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>yum安装软件失败</title>
    <link href="http://tokyle.com/2018/04/04/yum%E5%AE%89%E8%A3%85%E8%BD%AF%E4%BB%B6%E5%A4%B1%E8%B4%A5/"/>
    <id>http://tokyle.com/2018/04/04/yum安装软件失败/</id>
    <published>2018-04-04T02:56:06.000Z</published>
    <updated>2018-04-04T03:02:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>centos运行yum报错解决办法</p><a id="more"></a><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>使用yum安装软件时，报错：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Another app is currently holding the yum lock; waiting for it to exit...</span><br><span class="line">  The other application is: PackageKit</span><br><span class="line">    Memory : 130 M RSS (1.0 GB VSZ)</span><br><span class="line">    Started: Wed Apr  4 10:44:50 2018 - 04:01 ago</span><br><span class="line">    State  : Sleeping, pid: 11199</span><br></pre></td></tr></table></figure></p><h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>该问题可能是由于系统目前处于自动升级状态，所以锁定了yum，只要强制关闭yum进程即可重新运行yum<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /var/run/yum.pid</span><br></pre></td></tr></table></figure></p><h3 id="优质yum源"><a href="#优质yum源" class="headerlink" title="优质yum源"></a>优质yum源</h3><p>Remi repository 是包含最新版本 PHP 和 MySQL 包的 Linux 源，由 Remi 提供维护。有个这个源之后，使用 YUM 安装或更新 PHP、MySQL、phpMyAdmin 等服务器相关程序的时候就非常方便了。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><br><span class="line">wget http://rpms.remirepo.net/enterprise/remi-release-7.rpm</span><br><span class="line">rpm -Uvh remi-release-7.rpm epel-release-latest-7.noarch.rpm</span><br><span class="line"># for RHEL only</span><br><span class="line">subscription-manager repos --enable=rhel-7-server-optional-rpms</span><br></pre></td></tr></table></figure><blockquote><p><a href="http://www.ttlsa.com/yum/linux-remi-repository/" target="_blank" rel="noopener">参考文章</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;centos运行yum报错解决办法&lt;/p&gt;
    
    </summary>
    
      <category term="Devops" scheme="http://tokyle.com/categories/Devops/"/>
    
    
      <category term="linux" scheme="http://tokyle.com/tags/linux/"/>
    
      <category term="centos7" scheme="http://tokyle.com/tags/centos7/"/>
    
      <category term="yum" scheme="http://tokyle.com/tags/yum/"/>
    
  </entry>
  
  <entry>
    <title>MySQL之SQL优化系列（二）</title>
    <link href="http://tokyle.com/2018/04/03/MySQL%E4%B9%8BSQL%E4%BC%98%E5%8C%96%E7%B3%BB%E5%88%97%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <id>http://tokyle.com/2018/04/03/MySQL之SQL优化系列（二）/</id>
    <published>2018-04-03T05:03:10.000Z</published>
    <updated>2018-04-03T05:08:34.000Z</updated>
    
    <content type="html"><![CDATA[<p>通过explain分析低效SQL的执行计划</p><a id="more"></a><h3 id="序言"><a href="#序言" class="headerlink" title="序言"></a>序言</h3><p>使用的数据库依然是mysql示例库sakila<br>接着上篇的<a href="http://tokyle.com/2018/03/09/MySQL%E4%B9%8BSQL%E4%BC%98%E5%8C%96%E7%B3%BB%E5%88%97%EF%BC%88%E4%B8%80%EF%BC%89/#more">MySQL之SQL优化系列（一）</a><br>当通过慢查询日志定位到执行效率较低的SQL之后，使用explain进行低效SQL的分析。</p><h3 id="使用EXPLAIN分析低效SQL的执行计划"><a href="#使用EXPLAIN分析低效SQL的执行计划" class="headerlink" title="使用EXPLAIN分析低效SQL的执行计划"></a>使用EXPLAIN分析低效SQL的执行计划</h3><p>使用EXPLAIN可以获取MySQL是如何执行SELECT语句的，包括在SELECT语句执行过程中表如何连接以及连接的顺序，如下示例SQL执行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select sum(amount) from customer a,payment b where 1=1 and a.customer_id = b.customer_id and email=&apos;JANE.BENNETT@sakilacustomer.org&apos;\G  </span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: a</span><br><span class="line">   partitions: NULL</span><br><span class="line">         type: ALL</span><br><span class="line">possible_keys: PRIMARY</span><br><span class="line">          key: NULL</span><br><span class="line">      key_len: NULL</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 599</span><br><span class="line">     filtered: 10.00</span><br><span class="line">        Extra: Using where</span><br><span class="line">*************************** 2. row *************************** </span><br><span class="line">           id: 1                                               </span><br><span class="line">  select_type: SIMPLE                                          </span><br><span class="line">        table: b                                               </span><br><span class="line">   partitions: NULL                                            </span><br><span class="line">         type: ref                                             </span><br><span class="line">possible_keys: idx_fk_customer_id                              </span><br><span class="line">          key: idx_fk_customer_id                              </span><br><span class="line">      key_len: 2                                               </span><br><span class="line">          ref: sakila.a.customer_id                            </span><br><span class="line">         rows: 26                                              </span><br><span class="line">     filtered: 100.00                                          </span><br><span class="line">        Extra: NULL                                            </span><br><span class="line">2 rows in set, 1 warning (0.01 sec)</span><br></pre></td></tr></table></figure></p><p>字段解释：</p><ul><li>select_type:表示select的类型，常见取值有SIMPLE(简单表，不使用表连接或子查询)、PRIMARY(主查询，外层的查询)、UNION(UNION中的第二个或者后面的查询语句)、SUBQUERY(子查询中的第一个SELECT)</li><li>table:输出结果集的表</li><li>type:表示MySQL在表中找到所需行的方法，或者称为访问类型，常见的有：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALL —— index —— range —— ref —— eq_ref —— const,system —— NULL</span><br></pre></td></tr></table></figure></li></ul><p>从做到右，性能由最差到最好。示例：</p><ol><li>type=ALL，全表扫描，MySQL遍历全表来找到匹配行：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film limit 1\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1                                              </span><br><span class="line">  select_type: SIMPLE                                         </span><br><span class="line">        table: film                                           </span><br><span class="line">   partitions: NULL                                           </span><br><span class="line">         type: ALL                                            </span><br><span class="line">possible_keys: NULL                                           </span><br><span class="line">          key: NULL                                           </span><br><span class="line">      key_len: NULL                                           </span><br><span class="line">          ref: NULL                                           </span><br><span class="line">         rows: 1000                                           </span><br><span class="line">     filtered: 100.00                                         </span><br><span class="line">        Extra: NULL                                           </span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></li></ol><p>2.type=index，索引全扫描，MySQL遍历整个索引来查询匹配的行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show index from film;</span><br></pre></td></tr></table></figure></p><p>获取得到film表的索引：<code>film_id(主键)</code>,<code>title</code>,<code>language_id</code>,<code>original_language_id</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  explain select title from film\G</span><br><span class="line">*************************** 1. row *************************** </span><br><span class="line">           id: 1                                               </span><br><span class="line">  select_type: SIMPLE                                          </span><br><span class="line">        table: film                                            </span><br><span class="line">   partitions: NULL                                            </span><br><span class="line">         type: index                                           </span><br><span class="line">possible_keys: NULL                                            </span><br><span class="line">          key: idx_title                                       </span><br><span class="line">      key_len: 767                                             </span><br><span class="line">          ref: NULL                                            </span><br><span class="line">         rows: 1000                                            </span><br><span class="line">     filtered: 100.00                                          </span><br><span class="line">        Extra: Using index                                     </span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>3.type=range,索引范围扫描，常见的有<code>between</code>,<code>&gt;</code>,<code>&lt;</code>等。<br>4.type=ref，使用非唯一索引扫描或唯一索引的前缀扫描，返回匹配单独值得记录行，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from payment where customer_id=24\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1                                              </span><br><span class="line">  select_type: SIMPLE                                         </span><br><span class="line">        table: payment                                        </span><br><span class="line">   partitions: NULL                                           </span><br><span class="line">         type: ref                                            </span><br><span class="line">possible_keys: idx_fk_customer_id                             </span><br><span class="line">          key: idx_fk_customer_id                             </span><br><span class="line">      key_len: 2                                              </span><br><span class="line">          ref: const                                          </span><br><span class="line">         rows: 25                                             </span><br><span class="line">     filtered: 100.00                                         </span><br><span class="line">        Extra: NULL                                           </span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>索引idx_fk_customer_id是非唯一索引，查询条件为等值查询条件customer_id=24，所以扫描索引的类型为ref。ref还经常出现在join操作中。<br>5.type=eq_ref，类似ref，区别在于使用的索引是唯一索引，对于每一个索引的键值，表中只有一条记录匹配。换句换说，就是在进行多表连接时，使用得失primary key或者unique index作为关联条件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select * from film a,film_text b where a.film_id = b.film_id\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           id: 1                                              </span><br><span class="line">  select_type: SIMPLE                                         </span><br><span class="line">        table: b                                              </span><br><span class="line">   partitions: NULL                                           </span><br><span class="line">         type: ALL                                            </span><br><span class="line">possible_keys: PRIMARY                                        </span><br><span class="line">          key: NULL                                           </span><br><span class="line">      key_len: NULL                                           </span><br><span class="line">          ref: NULL                                           </span><br><span class="line">         rows: 1000                                           </span><br><span class="line">     filtered: 100.00                                         </span><br><span class="line">        Extra: NULL                                           </span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">           id: 1                                              </span><br><span class="line">  select_type: SIMPLE                                         </span><br><span class="line">        table: a                                              </span><br><span class="line">   partitions: NULL                                           </span><br><span class="line">         type: eq_ref                                         </span><br><span class="line">possible_keys: PRIMARY                                        </span><br><span class="line">          key: PRIMARY                                        </span><br><span class="line">      key_len: 2                                              </span><br><span class="line">          ref: sakila.b.film_id                               </span><br><span class="line">         rows: 1                                              </span><br><span class="line">     filtered: 100.00                                         </span><br><span class="line">        Extra: Using where                                    </span><br><span class="line">2 rows in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>6.type=const/system，表单中有最多一个匹配行，查询起来非常迅速，所以这个匹配行中的其他列的值可以被优化器在当前查询中当做常量来处理，例如，根据主键primary key或者唯一索引unique index进行的查询。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">alter table customer add unique index uk_email(email);</span><br><span class="line">mysql&gt; explain select * from (select * from customer where email=&apos;LINDA.WILLIAMS@sakilacustomer.org&apos;) a\G</span><br><span class="line">*************************** 1. row *************************** </span><br><span class="line">           id: 1                                               </span><br><span class="line">  select_type: SIMPLE                                          </span><br><span class="line">        table: customer                                        </span><br><span class="line">   partitions: NULL                                            </span><br><span class="line">         type: const                                           </span><br><span class="line">possible_keys: uk_email                                        </span><br><span class="line">          key: uk_email                                        </span><br><span class="line">      key_len: 153                                             </span><br><span class="line">          ref: const                                           </span><br><span class="line">         rows: 1                                               </span><br><span class="line">     filtered: 100.00                                          </span><br><span class="line">        Extra: NULL                                            </span><br><span class="line">1 row in set, 1 warning (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>通过唯一索引uk_email访问的时候，类型type为const。</p><ul><li>possible_keys：表示查询时可能使用的索引</li><li>key：表示实际使用的索引</li><li>key_len：使用到索引字段的长度、</li><li>rows：扫描行的数量</li><li>Extra：执行情况的说明和描述，包含不适合在其他列中显示但是对执行计划非常重要的额外信息。</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;通过explain分析低效SQL的执行计划&lt;/p&gt;
    
    </summary>
    
      <category term="MySQL-SQL优化" scheme="http://tokyle.com/categories/MySQL-SQL%E4%BC%98%E5%8C%96/"/>
    
    
      <category term="mysql" scheme="http://tokyle.com/tags/mysql/"/>
    
      <category term="explain" scheme="http://tokyle.com/tags/explain/"/>
    
  </entry>
  
  <entry>
    <title>python性能测试框架locust（一）</title>
    <link href="http://tokyle.com/2018/03/30/python%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6locust%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <id>http://tokyle.com/2018/03/30/python性能测试框架locust（一）/</id>
    <published>2018-03-30T09:45:23.000Z</published>
    <updated>2018-03-30T09:46:44.000Z</updated>
    
    <content type="html"><![CDATA[<p>基于python的性能测试框架LOCUST系列一</p><a id="more"></a><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>首先，这个框架是做性能测试的，然后，基于python编写！！！所以，不可能不研究研究啊。<br>LOCUST英文意思是“蝗虫”，感受感受使用locust进行性能测试，并发请求就像铺天盖地的蝗虫一样攻击你的系统，嗯，想想都可怕。</p><p>在Locust测试框架中，测试场景是由纯python脚本编写，对于http以及https协议，可以使用python的requests库作为客户端。对于其他协议，locust也提供有接口。也就是说，只要我们使用python编写对应的请求，就能方便的用locust进行压力测试。</p><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>安装locust很简单，日常操作：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install locustio</span><br></pre></td></tr></table></figure></p><h3 id="demo示例"><a href="#demo示例" class="headerlink" title="demo示例"></a>demo示例</h3><p>官方demo：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">@author: kyle shi</span><br><span class="line">@time: 2018/3/30/030 16:59</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from locust import HttpLocust, TaskSet, task</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserBehavior(TaskSet):</span><br><span class="line">    def on_start(self):</span><br><span class="line">        &quot;&quot;&quot; on_start is called when a Locust start before any task is scheduled &quot;&quot;&quot;</span><br><span class="line">        self.login()</span><br><span class="line"></span><br><span class="line">    def login(self):</span><br><span class="line">        self.client.post(&quot;/login&quot;, &#123;&quot;username&quot;: &quot;ellen_key&quot;, &quot;password&quot;: &quot;education&quot;&#125;)</span><br><span class="line"></span><br><span class="line">    @task(2)</span><br><span class="line">    def index(self):</span><br><span class="line">        self.client.get(&quot;/&quot;)</span><br><span class="line"></span><br><span class="line">    @task(1)</span><br><span class="line">    def profile(self):</span><br><span class="line">        self.client.get(&quot;/profile&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class WebsiteUser(HttpLocust):</span><br><span class="line">    task_set = UserBehavior</span><br><span class="line">    host = &apos;http://example.com&apos;</span><br><span class="line">    min_wait = 5000</span><br><span class="line">    max_wait = 9000</span><br></pre></td></tr></table></figure></p><p>cmd进入该文件所在路径下，执行locust命令，即可开启locust web服务，默认端口8089<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">E:\py_workspace\LocustTest\codings\TestScripts &#123;git&#125;</span><br><span class="line">&#123;lamb&#125; ls</span><br><span class="line">__init__.py  __pycache__  locustfile.py</span><br><span class="line"></span><br><span class="line">E:\py_workspace\LocustTest\codings\TestScripts &#123;git&#125;</span><br><span class="line">&#123;lamb&#125; locust</span><br><span class="line">[2018-03-30 17:22:44,919] 3HET0MVY93LITXF/INFO/locust.main: Starting web monitor at *:8089</span><br><span class="line">[2018-03-30 17:22:44,920] 3HET0MVY93LITXF/INFO/locust.main: Starting Locust 0.8.1</span><br></pre></td></tr></table></figure></p><p>打开浏览器，输入url:<code>http://localhost:8089</code>即可访问locust web。</p><p>tips：<br>使用<code>locust</code>打开服务前提是脚本名称是<code>locustfile.py</code>；否则需要执行指定脚本的命令：<br><code>locust -f mylocustFile.py -P 7070</code>指定文件和端口</p><h3 id="demo简单分析"><a href="#demo简单分析" class="headerlink" title="demo简单分析"></a>demo简单分析</h3><p>官方的demo对于<code>http://example.com</code>进行压测，随机访问首页（<code>/</code>）以及页面（<code>/profile</code>）比例为2:1，每次请求间隔为5~9s。</p><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>locust现在还是刚刚开始接触，看着官方介绍的，功能相当齐全，尤其是我还是一个只有python编码能力的菜鸡。。。太对胃口了。。。好好研究！</p><blockquote><p><a href="https://locust.io/" target="_blank" rel="noopener">官网</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;基于python的性能测试框架LOCUST系列一&lt;/p&gt;
    
    </summary>
    
      <category term="性能测试" scheme="http://tokyle.com/categories/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="python" scheme="http://tokyle.com/tags/python/"/>
    
      <category term="Locust" scheme="http://tokyle.com/tags/Locust/"/>
    
  </entry>
  
  <entry>
    <title>loadrunner监控Mysql</title>
    <link href="http://tokyle.com/2018/03/30/loadrunner%E7%9B%91%E6%8E%A7Mysql/"/>
    <id>http://tokyle.com/2018/03/30/loadrunner监控Mysql/</id>
    <published>2018-03-30T07:31:34.000Z</published>
    <updated>2018-04-02T02:32:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>使用loadrunner监控mysql</p><a id="more"></a><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近工作需要研究怎么深度性能测试，使用的工具基本是loadrunner，jmeter或者基于python的框架locust。<br>近期一段时间应该和lr打交道会比较多，lr最为一个收费的专业性能测试软件，功能是毋庸置疑的相当强大，但是，貌似我没有找到监控mysql的模块。。sql server倒是有，也可能是我远离lr太长时间了。</p><h3 id="mysql性能监控"><a href="#mysql性能监控" class="headerlink" title="mysql性能监控"></a>mysql性能监控</h3><p>在日常性能测试过程中，除了需要对系统TPS，RT这样的参数进行监控以及各服务器的CPU，MEMORY，IO之外，还要实时对数据库进行监控，因为接触的多的是mysql，就以MySQL为例。</p><p>当mysql出现运行缓慢，或者出于某种原因无法响应查询，可以监控以下几个指标来获取解决：</p><ol><li>查询吞吐量</li><li>查询执行性能</li><li>连接情况</li><li>数据库缓冲池</li></ol><h4 id="吞吐量"><a href="#吞吐量" class="headerlink" title="吞吐量"></a>吞吐量</h4><p>由于本篇重点是介绍监控MySQL，对于mysql的性能指标就只解释一种，以吞吐量为例：<br>MySQL中有一个<code>Questions</code>的内部计数器，客户端每发送一个查询，改值加一。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global status like &quot;Questions&quot;;</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+-------+</span><br><span class="line">| Questions     | 665   |</span><br><span class="line">+---------------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p><p>所以对<code>Questions</code>该指标进行监控，当该指标发生突变，如骤降或者骤增，很可能数据库出现了问题。</p><h3 id="HP-SiteScope"><a href="#HP-SiteScope" class="headerlink" title="HP SiteScope"></a>HP SiteScope</h3><p>WIKIPEDIA给的解释：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HP SiteScope is agentless monitoring software focused on monitoring the availability and performance of distributed IT infrastructures, including Servers, Network devices and services, Applications and application components, operating systems and various IT enterprise components.</span><br></pre></td></tr></table></figure></p><p>大致意思是：HP SiteScope是无代理监控软件，专注于监控分布式IT基础架构的可用性和性能，包括服务器，网络设备和服务，应用程序和应用程序组件，操作系统和各种IT企业组件。<br>所以，HP SiteScope很适合用来监控MySQL。</p><h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>网上找一圈硬是没找到安装包，很怀疑对于mysql的监控有更简单的方法，或者就是压根没人做开源的。。直接梯子到官网下了个11.3的版本：</p><blockquote><p><a href="https://pan.baidu.com/s/1h3MZP0JM3TTTw8q9nbcG2A" target="_blank" rel="noopener">度娘盘连接</a>  密码：7l99<br><a href="https://pan.baidu.com/s/1GpszOZXKS8od5barKx0c1g" target="_blank" rel="noopener">mysql驱动</a>密码：y9i8</p></blockquote><p>安装很简单，压缩包打开，找到<code>HPSiteScope_11.30_setup.exe</code>一路next即可，mysql驱动放在<code>D:\HP\SiteScope\java\lib\ext</code>下。</p><h3 id="LR监控MySQL操作"><a href="#LR监控MySQL操作" class="headerlink" title="LR监控MySQL操作"></a>LR监控MySQL操作</h3><p>安装完成HP SiteScope后，在浏览器输入url：<code>http://127.0.0.1:8080/SiteScope</code>即可打开主页</p><h4 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h4><p>输入url之后，可能会遇见页面是空白的情况（我就遇到过），首先，别用chrome和firefox，这玩意貌似只能在IE上面打开；其次，你本地需要JDK环境（java -version）要求JDK1.6以上。最后，IE的internet选项中，把局域网设置里的代理勾掉。以上就是我解决的页面空白的三个办法（我全中过，折腾老半天）</p><p>进入HP SiteScope首页，在<code>SiteScope</code>上右键，<code>新建组</code>，输入组名之后，右键创建的组，<code>新建监控器</code>，选择<code>数据库计数器</code>，只需要配置几项：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">数据库连接URL:jdbc:mysql://localhost/sakila</span><br><span class="line">查询：show status</span><br><span class="line">数据库驱动程序： org.gjt.mm.mysql.Driver</span><br><span class="line">凭据：输入数据库用户名及密码</span><br><span class="line">计数器：选择计数器：</span><br><span class="line">Com_insert_select/Value</span><br><span class="line">Com_select/Value</span><br><span class="line">counters in error</span><br><span class="line">Questions/Value</span><br><span class="line">Select_scan/Value</span><br></pre></td></tr></table></figure></p><p>点击验证保存，完成保存。</p><h4 id="lr配置监控"><a href="#lr配置监控" class="headerlink" title="lr配置监控"></a>lr配置监控</h4><p>打开LR Contraller，配置完场景，在run页面，可用图，选择<code>SiteScope图</code>，右键SiteScope，点击打开，右击打开的SiteScope图，点击<code>添加度量</code>，弹出的窗口有两个添加，上面一个是添加服务器，我添加的是<code>localhost</code>端口<code>8888</code>，下一个添加是选择添加的组件，选择需要的添加组件，点击确定，即可完成配置。<br>（没办法，图床都太坑了，所以全程无图。。。请原谅。。。）</p><h3 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h3><p>官网下载的HP SiteScope是未破解版，有时间还是需要折腾个破解版的研究研究。工具是会用了，原理根本没去看，这是病，不懂原理就直接使用，总感觉不踏实。</p><blockquote><p><a href="https://www.jianshu.com/p/fce30e333578" target="_blank" rel="noopener">参考地址</a></p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用loadrunner监控mysql&lt;/p&gt;
    
    </summary>
    
      <category term="性能测试" scheme="http://tokyle.com/categories/%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="loadrunner" scheme="http://tokyle.com/tags/loadrunner/"/>
    
      <category term="SiteScope" scheme="http://tokyle.com/tags/SiteScope/"/>
    
  </entry>
  
</feed>
